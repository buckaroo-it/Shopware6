(function(){var e={227:function(){},708:function(){},964:function(){},60:function(){let{ApiService:e}=Shopware.Classes;class t extends e{constructor(e,t,a="buckaroo"){super(e,t,a)}getBasicHeaders(){return this.loginService&&"function"==typeof this.loginService.getToken?super.getBasicHeaders():{"Content-Type":"application/json",Accept:"application/json"}}getSupportVersion(){let t=`_action/${this.getApiBasePath()}/version`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}getTaxes(){let t=`_action/${this.getApiBasePath()}/taxes`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}getIn3Icons(){let t=`_action/${this.getApiBasePath()}/in3/logos`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}getApiTest(t,a,n){let i=`_action/${this.getApiBasePath()}/getBuckarooApiTest`;return this.httpClient.post(i,{websiteKeyId:t,secretKeyId:a,saleChannelId:n},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}}Shopware.Service().register("BuckarooPaymentSettingsService",()=>{let e=Shopware.Application.getContainer("init"),a=Shopware.Service("loginService");return new t(e.httpClient,a)})},444:function(){let{ApiService:e}=Shopware.Classes;class t extends e{constructor(e,t,a="buckaroo"){super(e,t,a)}getBasicHeaders(){return this.loginService&&"function"==typeof this.loginService.getToken?super.getBasicHeaders():{"Content-Type":"application/json",Accept:"application/json"}}getBuckarooTransaction(t){let a=`_action/${this.getApiBasePath()}/getBuckarooTransaction`;return this.httpClient.post(a,{transaction:t},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}refundPayment(t,a,n,i){let o=`_action/${this.getApiBasePath()}/refund`;return this.httpClient.post(o,{transaction:t,transactionsToRefund:a,orderItems:n,customRefundAmount:i},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}captureOrder(t){let a=`_action/${this.getApiBasePath()}/capture`;return this.httpClient.post(a,{transaction:t},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}createPaylink(t){let a=`_action/${this.getApiBasePath()}/paylink`;return this.httpClient.post(a,{transaction:t},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}}Shopware.Service().register("BuckarooPaymentService",()=>{let e=Shopware.Application.getContainer("init");return new t(e.httpClient,e.loginService||null)})},476:function(){let{Component:e}=Shopware;e.extend("buckaroo-payment-config","sw-extension-config",{})},572:function(e,t,a){var n=a(227);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),a(346).Z("0e1d6e3c",n,!0,{})},284:function(e,t,a){var n=a(708);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),a(346).Z("5d71e84c",n,!0,{})},500:function(e,t,a){var n=a(964);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),a(346).Z("178bfe29",n,!0,{})},346:function(e,t,a){"use strict";function n(e,t){for(var a=[],n={},i=0;i<t.length;i++){var o=t[i],r=o[0],s={id:e+":"+i,css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(s):a.push(n[r]={id:r,parts:[s]})}return a}a.d(t,{Z:function(){return h}});var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},r=i&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,c=!1,u=function(){},d=null,p="data-vue-ssr-id",m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function h(e,t,a,i){c=a,d=i||{};var r=n(e,t);return g(r),function(t){for(var a=[],i=0;i<r.length;i++){var s=o[r[i].id];s.refs--,a.push(s)}t?g(r=n(e,t)):r=[];for(var i=0;i<a.length;i++){var s=a[i];if(0===s.refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete o[s.id]}}}}function g(e){for(var t=0;t<e.length;t++){var a=e[t],n=o[a.id];if(n){n.refs++;for(var i=0;i<n.parts.length;i++)n.parts[i](a.parts[i]);for(;i<a.parts.length;i++)n.parts.push(f(a.parts[i]));n.parts.length>a.parts.length&&(n.parts.length=a.parts.length)}else{for(var r=[],i=0;i<a.parts.length;i++)r.push(f(a.parts[i]));o[a.id]={id:a.id,refs:1,parts:r}}}}function y(){var e=document.createElement("style");return e.type="text/css",r.appendChild(e),e}function f(e){var t,a,n=document.querySelector("style["+p+'~="'+e.id+'"]');if(n){if(c)return u;n.parentNode.removeChild(n)}if(m){var i=l++;t=k.bind(null,n=s||(s=y()),i,!1),a=k.bind(null,n,i,!0)}else t=v.bind(null,n=y()),a=function(){n.parentNode.removeChild(n)};return t(e),function(n){n?(n.css!==e.css||n.media!==e.media||n.sourceMap!==e.sourceMap)&&t(e=n):a()}}var b=function(){var e=[];return function(t,a){return e[t]=a,e.filter(Boolean).join("\n")}}();function k(e,t,a,n){var i=a?"":n.css;if(e.styleSheet)e.styleSheet.cssText=b(t,i);else{var o=document.createTextNode(i),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}function v(e,t){var a=t.css,n=t.media,i=t.sourceMap;if(n&&e.setAttribute("media",n),d.ssrId&&e.setAttribute(p,t.id),i&&(a+="\n/*# sourceURL="+i.sources[0]+" */\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,a),o.exports}a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="bundles/buckaroopayments/",window?.__sw__?.assetPath&&(a.p=window.__sw__.assetPath+"/bundles/buckaroopayments/"),function(){"use strict";let{Component:e,Context:t}=Shopware,n=Shopware.Data.Criteria;e.override("sw-order-detail",{template:'{% block sw_order_detail_content_tabs %}\n    <div\n     v-if="isPaymentInTestMode && setIsBuckarooPayment"\n     style="max-width: 960px; margin: 0 auto 15px; background: rgb(251, 227, 231); border-radius:4px; color: #de294c; display:flex; align-items:center;">\n        <div style="background:#de294c;padding: 4px 8px;border-radius: 4px 0 0 4px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="m13.7744 1.4124 9.7058 18.6649c.5096.98.1283 2.1875-.8517 2.6971a2 2 0 0 1-.9227.2256H2.2942c-1.1045 0-2-.8954-2-2a2 2 0 0 1 .2256-.9227l9.7058-18.665c.5096-.98 1.7171-1.3613 2.6971-.8517a2 2 0 0 1 .8517.8518zM2.2942 21h19.4116L12 2.335 2.2942 21zM12 17c.5523 0 1 .4477 1 1s-.4477 1-1 1-1-.4477-1-1 .4477-1 1-1zm1-2c0 .5523-.4477 1-1 1s-1-.4477-1-1v-5c0-.5523.4477-1 1-1s1 .4477 1 1v5z" id="icons-default-warning"></path></defs><use xlink:href="#icons-default-warning" fill="#fff" fill-rule="evenodd"></use></svg></div>\n        <p style="margin-left:10px;">{{ $tc(\'buckaroo-payment.paymentInTestMode\') }}</p>\n    </div>\n    {% parent %}\n{% endblock %}\n\n\n{% block sw_order_detail_content_tabs_general %}\n    {% parent %}\n\n    <sw-tabs-item v-if="setIsBuckarooPayment" :route="{ name: \'buckaroo.payment.detail\', params: { id: $route.params.id } }" :title="$tc(\'buckaroo-payment.tabs.title\')">\n        {{ $tc(\'buckaroo-payment.tabs.title\') }}\n    </sw-tabs-item>\n    \n{% endblock %}\n\n{% block sw_order_detail_actions %}\n    <template v-if="isEditable">\n    </template>\n    {% parent %}\n{% endblock %}',data(){return{isBuckarooPayment:!1,isPaymentInTestMode:!1}},computed:{isEditable(){return!this.isBuckarooPayment||"buckaroo.payment.detail"!==this.$route.name},showTabs(){return!0}},watch:{orderId:{deep:!0,handler(){if(!this.orderId){this.setIsBuckarooPayment(null);return}let e=this.repositoryFactory.create("order"),a=new n(1,1);a.addAssociation("transactions"),e.get(this.orderId,t.api,a).then(e=>{if(this.setPaymentInTestMode(e),e.transactions.length<=0||!e.transactions.last().paymentMethodId){this.setIsBuckarooPayment(null);return}let t=e.transactions.last().paymentMethodId;null!=t&&this.setIsBuckarooPayment(t)})},immediate:!0}},methods:{setPaymentInTestMode(e){e.customFields&&e.customFields.buckaroo_payment_in_test_mode&&(this.isPaymentInTestMode=!0===e.customFields.buckaroo_payment_in_test_mode)},setIsBuckarooPayment(e){e&&this.repositoryFactory.create("payment_method").get(e,t.api).then(e=>{this.isBuckarooPayment=e.formattedHandlerIdentifier.indexOf("buckaroo")>=0})}}});let{Component:i,Context:o}=Shopware;Shopware.Data.Criteria,i.override("sw-order-detail-base",{template:'{% block sw_order_detail_base_line_items_summary %}\n\n    <sw-card-section divider="top" secondary slim v-if="order.customFields !== null">\n        <sw-container columns="1fr 440px"\n        class="sw-order-detail__summary" v-if="order.customFields.buckarooFee !== null && order.customFields.buckarooFee > 0">\n            <sw-description-list grid="265px 1fr"\n            class="sw-order-detail__summary-data">\n                <dt>{{ $tc(\'buckaroo-payment.fee\') }}</dt>\n                <dd>{{ order.customFields.buckarooFee }}\n                    {% if order.currency.isoCode == "PLN" %}\n                        PLN\n                    {% else %}\n                        {{ order.currency.symbol }}\n                    {% endif %}\n                    </dd>\n            </sw-description-list>\n        </sw-container>\n    </sw-card-section>\n\n    {% parent %}\n    \n{% endblock %}'});let{Component:r}=Shopware;r.override("sw-order-user-card",{template:"{% block sw_order_detail_base_secondary_info_payment %}\n    <template v-if=\"currentOrder.transactions.length > 0 && (!currentOrder.transactions.last().paymentMethod.translated.customFields || !currentOrder.transactions.last().paymentMethod.translated.customFields.is_buckaroo)\">\n        {% parent %}\n    </template>\n    <template v-if=\"currentOrder.transactions.length > 0 && currentOrder.transactions.last().paymentMethod.translated.customFields && currentOrder.transactions.last().paymentMethod.translated.customFields.is_buckaroo\">\n        <dt>{{ $tc('sw-order.detailBase.labelPaymentMethod') }}</dt>\n        <dd>\n            <template v-if=\"config['BuckarooPayments.config.' + currentOrder.transactions.last().paymentMethod.translated.customFields.buckaroo_key + 'Label']\">\n                {{ config['BuckarooPayments.config.' + currentOrder.transactions.last().paymentMethod.translated.customFields.buckaroo_key + 'Label'] }}\n            </template>\n        </dd>\n    </template>\n{% endblock %}\n\n",inject:["systemConfigApiService"],data(){return{config:{}}},created(){this.systemConfigApiService.getValues("BuckarooPayments.config",null).then(e=>{this.config=e}).finally(()=>{})}});let{Component:s}=Shopware;s.override("sw-system-config",{template:' {% block sw_system_config_content_card %}\n    <template v-if="domain !== \'BuckarooPayments.config\'">\n        {% parent() %}\n    </template>\n    <template v-else>\n       <buckaroo-main-config\n            :value="actualConfigData[currentSalesChannelId]"\n            :configSettings="config"\n            :isNotDefaultSalesChannel="isNotDefaultSalesChannel"\n            :currentSalesChannelId="currentSalesChannelId"\n            :elementMethods="{getElementBind, getFieldError, getInheritWrapperBind, getInheritedValue, hasMapInheritanceSupport, getInlineSnippet, kebabCase}"\n            @input="onConfigDataUpdate"\n            v-if="!isLoading && actualConfigData[currentSalesChannelId] && config && config.length > 0"\n        ></buckaroo-main-config>\n    </template>\n {% endblock %}',createdComponent(){this.$super("createdComponent"),this.loadBuckarooConfigData()},methods:{loadBuckarooConfigData(){this.systemConfigApiService.getValues("BuckarooPayments.config",this.currentSalesChannelId).then(e=>{this.actualConfigData[this.currentSalesChannelId]||(this.actualConfigData[this.currentSalesChannelId]={});let t={};e&&"object"==typeof e&&Object.keys(e).forEach(a=>{let n=e[a];n&&"object"==typeof n&&n.hasOwnProperty("_value")?t[a]=n._value:t[a]=n;let i=a.replace("BuckarooPayments.config.","");i!==a&&(t[i]=t[a])}),this.actualConfigData[this.currentSalesChannelId]={},Object.keys(t).forEach(e=>{this.actualConfigData[this.currentSalesChannelId][e]=t[e]}),this.$nextTick(()=>{this.$forceUpdate()})}).catch(e=>{console.error("Error fetching system config:",e)})},onConfigDataUpdate(e){this.actualConfigData[this.currentSalesChannelId]||(this.actualConfigData[this.currentSalesChannelId]={}),Object.keys(e).forEach(t=>{if(this.actualConfigData[this.currentSalesChannelId][t]=e[t],!t.startsWith("BuckarooPayments.config.")){let a=`BuckarooPayments.config.${t}`;this.actualConfigData[this.currentSalesChannelId][a]=e[t]}})},saveAll(){return"BuckarooPayments.config"!==this.domain?this.$super("saveAll"):this.saveBuckaroo()},saveBuckaroo(){return this.isLoading=!0,this.systemConfigApiService.batchSave(this.getSelectedValues()).finally(()=>{this.isLoading=!1})},getCurrentConfigCard(){let e=this.$route.params?.paymentCode||"general";return this.config.filter(t=>t.name===e)?.pop()},getSelectedValues(){let e=this.actualConfigData[this.currentSalesChannelId],t=this.getCurrentConfigCard();if(t?.elements){let a={};return t?.elements.forEach(t=>{if(t?.name){let n=e[t.name];void 0===n&&(n=e[t.name.replace("BuckarooPayments.config.","")]),a[t.name]=n}}),{[this.currentSalesChannelId]:a}}return this.actualConfigData}}}),a(500);let{Component:l,Filter:c,Context:u}=Shopware,d=Shopware.Data.Criteria;l.register("buckaroo-payment-detail",{template:'{% block buckaroo_payment_detail %}\n    <div class="buckaroo-payment-detail">\n        \n        <sw-card positionIdentifier="bk-paylink" :title="$tc(\'buckaroo-payment.paymentDetail.paylinkTitle\')" v-if="isPaylinkVisible">\n\n            {{ $tc(\'buckaroo-payment.paymentDetail.paylinkDescription\') }}\n            \n            <span v-if="paylink"> <br>\n            {{ $tc(\'buckaroo-payment.paymentDetail.yourLink\') }}: <a :href="paylink">{{ paylink }}</a>\n            </span>\n\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt> <dd>\n            \n                        <sw-button @click="createPaylink(orderId)" :disabled="!isPaylinkAvailable">\n                            {{ $tc(\'buckaroo-payment.paymentDetail.paylinkButton\') }}\n                        </sw-button></dd>\n                </sw-description-list>\n            </sw-container>\n\n        </sw-card>\n\n         <sw-card positionIdentifier="bk-refund" :title="$tc(\'buckaroo-payment.paymentDetail.refundTitle\')">\n            \n            {{ $tc(\'buckaroo-payment.orderItems.title\') }}\n            <sw-data-grid :dataSource="orderItems"\n                :columns="orderItemsColumns"\n                :showActions="false"\n                :showSelection="false">\n\n                    <template #column-name="{ item }">\n                        <sw-product-variant-info :showTooltip="false" :variations="item.variations">\n                            {{ item.name }}\n                        </sw-product-variant-info>\n                    </template>\n                    <template #column-quantity="{ item }">\n                        <input class="bk-reund-qty" type="number" min="0" :max="item.quantityMax" v-model="item.quantity" @input="recalculateOrderItems" onkeydown="return event.keyCode !== 69">\n                    </template>\n\n            </sw-data-grid>\n\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data">\n                        <dt>{{ $tc(\'buckaroo-payment.paymentDetail.amountTotalTitle\') }}: </dt>\n                        <dd>{{ buckaroo_refund_amount }}  {{ currency }}</dd>\n                </sw-description-list>\n            </sw-container>\n                 \n            <sw-card-section divider="top" secondary slim>\n                <sw-container columns="1fr 440px"\n                              class="sw-order-detail__summary">\n                </sw-container>\n\n                <sw-data-grid :dataSource="transactionsToRefund"\n                    :columns="transactionsToRefundColumns"\n                    :showHeader="false"\n                    :showActions="false"\n                    :showSelection="false">\n\n                        <template #column-transaction_method="{ item }">\n                                <span v-if="item.transaction_method == \'KbcPaymentButton\'">\n                                    Kbc\n                                </span>\n                                <span v-else>\n                                    {{ item.transaction_method }}\n                                </span>\n                        </template>\n\n                        <template #column-amount="{ item }">\n                            <input type="number" min="0" :max="item.amountMax" v-model="item.amount"  @input="recalculateRefundItems" onkeydown="return event.keyCode !== 69">\n                        </template>\n\n                </sw-data-grid>\n\n                <sw-container v-if="!isAuthorized" columns="1fr 440px" class="sw-order-detail__summary">\n                    <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data">\n                            <dt>{{ $tc(\'buckaroo-payment.paymentDetail.amountCustomRefundTitle\') }}: </dt>\n                            <dd>\n                                <input id="buckaroo_custom_refund_enabled" type="checkbox"\n                                       @click="toggleCustomRefund()">\n                                <input id="buckaroo_custom_refund_amount" type="number"\n                                       v-model="buckaroo_refund_total_amount" disabled style="width:70px;"> {{ currency }}\n                            </dd>\n                    </sw-description-list>\n                    <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data">\n                            <dt>{{ $tc(\'buckaroo-payment.paymentDetail.amountRefundTotalTitle\') }}: </dt>\n                            <dd>{{ buckaroo_refund_total_amount }} {{ currency }}</dd>\n                    </sw-description-list>\n                </sw-container>\n                 \n            </sw-card-section>\n\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt><dd>\n                    <sw-button @click="refundOrder(orderId, buckaroo_refund_amount)" :disabled="!isRefundPossible || isAuthorized">\n                    {{ $tc(\'buckaroo-payment.paymentDetail.buttonTitle\') }}\n                    </sw-button></dd>\n                </sw-description-list>\n            </sw-container>\n\n         </sw-card>\n\n        <sw-card positionIdentifier="bk-pay-desc" :title="$tc(\'buckaroo-payment.paymentDetail.payTitle\')">\n\n            {{ $tc(\'buckaroo-payment.paymentDetail.payDescription\') }}\n\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt><dd>\n                        <sw-button @click="captureOrder(orderId)" :disabled="!isCapturePossible">\n                            {{ $tc(\'buckaroo-payment.paymentDetail.payButton\') }}\n                        </sw-button></dd>\n                </sw-description-list>\n            </sw-container>\n\n        </sw-card>\n\n         <sw-card positionIdentifier="bk-pay-transaction" :title="$tc(\'buckaroo-payment.paymentDetail.transactionsTitle\')">\n            <sw-data-grid :dataSource="relatedResources"\n                :columns="relatedResourceColumns"\n                :showActions="false"\n                :showSelection="false">\n\n                    <template #column-transaction_method="{ item }">\n                            <span v-if="item.transaction_method == \'KbcPaymentButton\'">\n                                Kbc\n                            </span>\n                            <span v-else>\n                                {{ item.transaction_method }}\n                            </span>\n                    </template>\n\n            </sw-data-grid>\n         </sw-card>\n\n\n        <sw-loader v-if="isLoading">\n        </sw-loader>\n    </div>\n{% endblock %}',inject:["repositoryFactory","BuckarooPaymentService","systemConfigApiService"],data(){return{config:{},buckaroo_refund_amount:"0",buckaroo_refund_total_amount:"0",currency:"EUR",isRefundPossible:!0,isCapturePossible:!1,isPaylinkAvailable:!1,isPaylinkVisible:!1,paylinkMessage:"",paylink:"",isLoading:!1,order:!1,buckarooTransactions:null,orderItems:[],transactionsToRefund:[],relatedResources:[],isAuthorized:!1}},computed:{orderItemsColumns(){return[{property:"name",label:this.$tc("buckaroo-payment.orderItems.types.name"),allowResize:!1,primary:!0,inlineEdit:!0,multiLine:!0},{property:"quantity",label:this.$tc("buckaroo-payment.orderItems.types.quantity"),rawData:!0,align:"right"},{property:"totalAmount",label:this.$tc("buckaroo-payment.orderItems.types.totalAmount"),rawData:!0,align:"right"}]},transactionsToRefundColumns(){return[{property:"transaction_method",rawData:!0},{property:"amount",rawData:!0}]},relatedResourceColumns(){return[{property:"created_at",label:this.$tc("buckaroo-payment.transactionHistory.types.created_at"),rawData:!0},{property:"total",label:this.$tc("buckaroo-payment.transactionHistory.types.total"),rawData:!0},{property:"shipping_costs",label:this.$tc("buckaroo-payment.transactionHistory.types.shipping_costs"),rawData:!0},{property:"total_excluding_vat",label:this.$tc("buckaroo-payment.transactionHistory.types.total_excluding_vat"),rawData:!0},{property:"vat",label:this.$tc("buckaroo-payment.transactionHistory.types.vat"),rawData:!0},{property:"transaction_key",label:this.$tc("buckaroo-payment.transactionHistory.types.transaction_key"),rawData:!0},{property:"transaction_method",label:this.$tc("buckaroo-payment.transactionHistory.types.transaction_method"),rawData:!0},{property:"statuscode",label:this.$tc("buckaroo-payment.transactionHistory.types.statuscode"),rawData:!0}]}},created(){this.createdComponent()},methods:{recalculateOrderItems(){for(let e in this.buckaroo_refund_amount=0,this.orderItems)this.orderItems[e].totalAmount=parseFloat(parseFloat(this.orderItems[e].unitPrice)*parseFloat(this.orderItems[e].quantity||0)).toFixed(2),this.buckaroo_refund_amount=parseFloat(parseFloat(this.buckaroo_refund_amount)+parseFloat(this.orderItems[e].totalAmount)).toFixed(2)},recalculateRefundItems(){for(let e in this.buckaroo_refund_total_amount=0,this.transactionsToRefund)this.transactionsToRefund[e].amount&&(this.buckaroo_refund_total_amount=parseFloat(parseFloat(this.buckaroo_refund_total_amount)+parseFloat(this.transactionsToRefund[e].amount)).toFixed(2))},getCustomRefundEnabledEl(){return document.getElementById("buckaroo_custom_refund_enabled")},getCustomRefundAmountEl(){return document.getElementById("buckaroo_custom_refund_amount")},toggleCustomRefund(){this.getCustomRefundEnabledEl()&&this.getCustomRefundAmountEl()&&(this.getCustomRefundAmountEl().disabled=!this.getCustomRefundEnabledEl().checked)},getCustomRefundAmount(){return this.getCustomRefundEnabledEl()&&this.getCustomRefundAmountEl()&&this.getCustomRefundEnabledEl().checked?this.getCustomRefundAmountEl().value:0},createdComponent(){let e=this,t=this.$route.params.id;this.systemConfigApiService.getValues("BuckarooPayments.config",null).then(e=>{this.config=e});let a=this.repositoryFactory.create("order"),n=new d(1,1);this.orderId=t,n.addAssociation("transactions.paymentMethod").addAssociation("transactions"),n.getAssociation("transactions").addSorting(d.sort("createdAt")),a.get(t,u.api,n).then(t=>{e.checkedIsAuthorized(t),e.isCapturePossible=t.transactions&&t.transactions.last().paymentMethod&&t.transactions.last().paymentMethod.customFields&&t.transactions.last().paymentMethod.customFields.buckaroo_key&&["klarnakp","billink"].includes(t.transactions.last().paymentMethod.customFields.buckaroo_key.toLowerCase())||e.isAfterpayCapturePossible(t),e.isPaylinkVisible=e.isPaylinkAvailable=this.getConfigValue("paylinkEnabled")&&t.stateMachineState&&t.stateMachineState.technicalName&&"open"==t.stateMachineState.technicalName&&t.transactions&&"open"==t.transactions.last().stateMachineState.technicalName}),this.BuckarooPaymentService.getBuckarooTransaction(t).then(t=>{e.orderItems=[],e.transactionsToRefund=[],e.relatedResources=[],this.$emit("loading-change",!1),t.orderItems.forEach(t=>{e.orderItems.push({id:t.id,name:t.name,quantity:t.quantity,quantityMax:t.quantity,unitPrice:t.unitPrice.value,totalAmount:t.totalAmount.value,variations:t.variations||[]})}),e.recalculateOrderItems(),t.transactionsToRefund.forEach(t=>{e.transactionsToRefund.push({id:t.id,transactions:t.transactions,amount:t.total,amountMax:t.total,currency:t.currency,transaction_method:t.transaction_method,logo:t.transaction_method?t.logo:null}),e.currency=t.currency}),e.recalculateRefundItems(),t.transactions.forEach(t=>{e.relatedResources.push({id:t.id,transaction_key:t.transaction,total:t.total,total_excluding_vat:t.total_excluding_vat,shipping_costs:t.shipping_costs,vat:t.vat,transaction_method:t.transaction_method,logo:t.transaction_method?t.logo:null,created_at:t.created_at,statuscode:t.statuscode})})}).catch(e=>{console.log("errorResponse",e)})},isAfterpayCapturePossible(e){return!0===e.customFields.buckaroo_is_authorize},checkedIsAuthorized(e){this.isAuthorized=e?.transactions?.last()?.stateMachineState?.technicalName==="authorized"},refundOrder(e,t){let a=this;a.isRefundPossible=!1,this.BuckarooPaymentService.refundPayment(e,this.transactionsToRefund,this.orderItems,this.getCustomRefundAmount()).then(e=>{for(let t in e)e[t].status?this.$store.dispatch("notification/createNotification",{variant:"success",title:a.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:a.$tc(e[t].message)+e[t].amount}):this.$store.dispatch("notification/createNotification",{variant:"error",title:a.$tc("buckaroo-payment.settingsForm.titleError"),message:a.$tc(e[t].message)});a.isRefundPossible=!0,this.createdComponent()}).catch(e=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:e.response.data.message}),a.isRefundPossible=!0})},createPaylink(e){let t=this;t.isPaylinkAvailable=!1,this.BuckarooPaymentService.createPaylink(e,this.transactionsToRefund,this.orderItems).then(e=>{e.status?(t.paylinkMessage=t.$tc(e.message)+e.paylinkhref,t.paylink=e.paylink,this.$store.dispatch("notification/createNotification",{variant:"success",title:t.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:t.paylinkMessage})):this.$store.dispatch("notification/createNotification",{variant:"error",title:t.$tc("buckaroo-payment.settingsForm.titleError"),message:t.$tc(e.message)}),t.isPaylinkAvailable=!0}).catch(e=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:e.response.data.message}),t.isPaylinkAvailable=!0})},getConfigValue(e){return this.config[`BuckarooPayments.config.${e}`]},captureOrder(e){let t=this;t.isCapturePossible=!1,this.BuckarooPaymentService.captureOrder(e,this.transactionsToRefund,this.orderItems).then(e=>{e.status?this.$store.dispatch("notification/createNotification",{variant:"success",title:t.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:e.message}):this.$store.dispatch("notification/createNotification",{variant:"error",title:t.$tc("buckaroo-payment.settingsForm.titleError"),message:e.message}),t.isCapturePossible=!0,this.createdComponent()}).catch(e=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:t.$tc(e.response.data.message)}),t.isCapturePossible=!0})}}}),a(476);var p=JSON.parse('{"buckaroo-payment":{"fee":"Buckaroo Betaaltoeslag","order":{"refundDescription":"Refund voor bestelling #orderNumber"},"general":{"title":"Buckaroo","description":"Buckaroo Payment"},"settingsForm":{"save":"Opslaan","titleSuccess":"Succes","titleError":"Foutmelding"},"supportModal":{"menuButton":"Version & Support","title":"Versie & Support","support":{"description":"Zorg ervoor dat u uw website key bij de hand heeft voordat u contact opneemt met Buckaroo technical support","label1":"Buckaroo Plaza:","label2":"Telefoonnummer:","label3":"E-mail:","label4":"Website:","your_version":"Uw PHP versie:","version":"Versie compatibiliteit","information":"Informatie"}},"tabs":{"title":"Buckaroo Payment","overview":"Overzicht"},"paymentDetail":{"yourLink":"Uw Paylink","paylinkButton":"Cre\xeber Paylink","paylinkDescription":"Cre\xeber Paylink voor order","paylinkTitle":"Paylink","refundTitle":"Terugbetaling","transactionsTitle":"Transacties","amountTitle":"Hoeveelheid","amountTotalTitle":"Algemeen totaal (grand total)","amountRefundTotalTitle":"Terugbetaling Algemeen totaal (grand total)","amountCustomRefundTitle":"Aangepast bedrag terugbetalen","buttonTitle":"Terugbetaling","successTitle":"Success","successMessage":"Buckaroo terugbetaling succesvol","errorTitle":"Foutmelding","payTitle":"Betaling vastleggen (Capture)","payDescription":"Factuur voor bestelling vastleggen (Capture) en aanmaken","payButton":"Betaling vastleggen (Capture)"},"orderItems":{"title":"Artikelen om terug te betalen","types":{"id":"id","name":"Titel","quantity":"Aantal om terug te betalen","totalAmount":"Subtotaal"}},"transactionsToRefund":{"title":"Terugbetaling Totaal"},"transactionHistory":{"types":{"id":"id","created_at":"Datum/tijd","total":"Totaal","shipping_costs":"Verzendkosten","total_excluding_vat":"Totaal exclusief BTW","total_including_vat":"Totaal inclusief BTW","vat":"BTW","transaction_key":"Transactie key","transaction_method":"Betaalmethode","statuscode":"Status"}},"messageNotValid":"Dit veld is niet geldig.","messageNotBlank":"Dit veld mag niet leeg zijn.","button":{"labelTestApi":"Test gegevens"},"afterpay":{"setup":"Belastingkoppeling instellen voor Riverty old ","hightTaxes":"Hoge BTW-heffingen","middleTaxes":"Middelmatige BTW-belastingen","lowTaxes":"Lage BTW-heffingen","zeroTaxes":"Nul VAT","noTaxes":"Geen BTW"},"paymentInTestMode":"De betaling voor deze bestelling is in testmodus uitgevoerd","refund":{"not_supported":"Terugbetaling wordt niet ondersteund","already_refunded":"Deze bestelling is al terugbetaald","refunded_amount":"Buckaroo terugbetaling succesvol"},"test_api":{"connection_ready":"Verbinding gereed","connection_failed":"Verbinding mislukt"},"paylink":{"invalid_amount":"Het bedrag is niet geldig","pay_link":"Uw Paylink:"},"missing_order_id":"Ontbrekende bestelling orderId","missing_transaction":"Order transactie niet gevonden","general_request_error":"Helaas is er een fout opgetreden tijdens het verwerken van uw aanvraag. Probeer het opnieuw.","in3LogoLabel":"Betaalmethode Logo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}}'),m=JSON.parse('{"buckaroo-payment":{"fee":"Buckaroo Geb\xfchr","order":{"refundDescription":"R\xfcckerstattung f\xfcr Bestellung #orderNumber"},"general":{"title":"Buckaroo","description":"Buckaroo Zahlung"},"settingsForm":{"save":"Speichern","titleSuccess":"Erfolg","titleError":"Fehler"},"supportModal":{"menuButton":"Version & Unterst\xfctzung","title":"Version & Unterst\xfctzung","support":{"description":"Bevor Sie den technischen Support von Buckaroo kontaktieren, bitte holen Sie Ihren (H\xe4ndler-)Schl\xfcssel und Geheimschl\xfcssel ab.","label1":"Buckaroo Plaza:","label2":"Telefon:","label3":"E-Mail:","label4":"Webseite:","your_version":"Ihre PHP-Version:","version":"Versionskompatibilit\xe4t","information":"Informationen"}},"tabs":{"title":"Buckaroo Payment","overview":"\xdcbersicht"},"paymentDetail":{"yourLink":"Ihr Paylink","paylinkButton":"Paylink erstellen","paylinkDescription":"Paylink erstellen f\xfcr Bestellung","paylinkTitle":"Paylink","refundTitle":"R\xfcckerstattung","transactionsTitle":"Transaktionen","amountTitle":"Betrag","amountTotalTitle":"Gesamtsumme","amountRefundTotalTitle":"Gesamtsumme der R\xfcckerstattung","amountCustomRefundTitle":"R\xfcckerstattung individueller Betrag","buttonTitle":"R\xfcckerstattung","successTitle":"Erfolg","successMessage":"Buckaroo-Erfolg, zur\xfcckerstattet","errorTitle":"Fehler","payTitle":"Zahlung erfassen (Capture)","payDescription":"Erfassen (Capture) und Rechnung f\xfcr Bestellung erstellen","payButton":"Zahlung erfassen (Capture)"},"orderItems":{"title":"Artikel zur R\xfcckerstattung","types":{"id":"id","name":"Titel","quantity":"Menge zur R\xfcckerstattung","totalAmount":"Teilsumme"}},"transactionsToRefund":{"title":"R\xfcckerstattungssummen"},"transactionHistory":{"types":{"id":"id","created_at":"Datum/Uhrzeit","total":"Gesamt","shipping_costs":"Versandkosten","total_excluding_vat":"Gesamt ohne MwSt. (VAT)","total_including_vat":"Gesamt inklusive MwSt. (VAT)","vat":"MwSt. (VAT)","transaction_key":"Transaktionsschl\xfcssel","transaction_method":"Zahlungsmethode","statuscode":"Status"}},"messageNotValid":"Dieses Feld ist nicht g\xfcltig.","messageNotBlank":"Dieses Feld darf nicht leer sein.","button":{"labelTestApi":"Verbindung testen"},"afterpay":{"setup":"Steuerzuordnung f\xfcr Riverty old einrichten ","hightTaxes":"Hohe MwSt. (VAT)","middleTaxes":"Mittlere MwSt. (VAT)","lowTaxes":"Niedrige MwSt. (VAT)","zeroTaxes":"Keine MwSt. (VAT)","noTaxes":"Keine Mehrwertsteuer"},"paymentInTestMode":"Die Zahlung f\xfcr diese Bestellung wurde im Testmodus durchgef\xfchrt","refund":{"not_supported":"R\xfcckerstattung wird nicht unterst\xfctzt","already_refunded":"Diese Bestellung wurde bereits zur\xfcckerstattet","refunded_amount":"Erfolgreich von Buckaroo erstattet"},"test_api":{"connection_ready":"Verbindung bereit","connection_failed":"Verbindung fehlgeschlagen"},"paylink":{"invalid_amount":"Betrag ist nicht g\xfcltig","pay_link":"Ihr Zahlungslink (Paylink):"},"missing_order_id":"Fehlende Bestell-ID","missing_transaction":"Transaktion der Bestellung nicht gefunden","general_request_error":"Leider ist ein Fehler bei der Bearbeitung Ihrer Anfrage aufgetreten. Bitte versuchen Sie es erneut.","in3LogoLabel":"Zahlungslogo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}}'),h=JSON.parse('{"buckaroo-payment":{"fee":"Buckaroo Fee","order":{"refundDescription":"Refund for order #orderNumber"},"general":{"title":"Buckaroo","description":"Buckaroo Payment"},"settingsForm":{"save":"Save","titleSuccess":"Success","titleError":"Error"},"supportModal":{"menuButton":"Version & Support","title":"Version & Support","support":{"description":"Before contacting Buckaroo technical support, please retrieve your (Merchant) key, Secret key, certificate and certificate thumbprint.","label1":"Buckaroo Payment Plaza:","label2":"Phone:","label3":"E-mail:","label4":"Website:","your_version":"Your PHP version:","version":"Version compatibility","information":"Information"}},"tabs":{"title":"Buckaroo Payment","overview":"Overview"},"paymentDetail":{"yourLink":"Your Paylink","paylinkButton":"Create paylink","paylinkDescription":"Create paylink for order","paylinkTitle":"Paylink","refundTitle":"Refund","transactionsTitle":"Transactions","amountTitle":"Amount","amountTotalTitle":"Grand total","amountRefundTotalTitle":"Refund Grand total","amountCustomRefundTitle":"Refund custom amount","buttonTitle":"Refund","successTitle":"Success","successMessage":"Buckaroo success refunded ","errorTitle":"Error","payTitle":"Capture payment","payDescription":"Capture and create invoice for order","payButton":"Capture payment"},"orderItems":{"title":"Items to Refund","types":{"id":"id","name":"Title","quantity":"Qty to Refund","totalAmount":"Subtotal"}},"transactionsToRefund":{"title":"Refund Totals"},"transactionHistory":{"types":{"id":"id","created_at":"Date/time","total":"Total","shipping_costs":"Shipping costs","total_excluding_vat":"Total excluding VAT","total_including_vat":"Total including VAT","vat":"VAT","transaction_key":"Transaction key","transaction_method":"Payment method","statuscode":"Status"}},"messageNotValid":"This field not valid.","messageNotBlank":"This field must not be empty.","button":{"labelTestApi":"Test connection"},"afterpay":{"setup":"Setup tax association for Riverty old ","hightTaxes":"High VAT taxes","middleTaxes":"Middle VAT taxes","lowTaxes":"Low VAT taxes","zeroTaxes":"Zero VAT","noTaxes":"No VAT tax"},"paymentInTestMode":"The payment for this order was made in test mode","refund":{"not_supported":"Refund is not supported","already_refunded":"This order is already refunded","refunded_amount":"Buckaroo success refunded"},"test_api":{"connection_ready":"Connection ready","connection_failed":"Connection failed"},"paylink":{"invalid_amount":"Amount is not valid","pay_link":"Your Paylink:"},"missing_order_id":"Missing order orderId","missing_transaction":"Order transaction not found","general_request_error":"Unfortunately an error occurred while processing your request. Please try again.","in3LogoLabel":"Payment Logo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}}');let{Module:g}=Shopware;g.register("buckaroo-payment",{type:"plugin",name:"BuckarooPayment",title:"buckaroo-payment.general.title",description:"buckaroo-payment.general.description",version:"1.0.0",targetVersion:"1.0.0",color:"#000000",icon:"default-action-settings",snippets:{"nl-NL":p,"de-DE":m,"en-GB":h},routeMiddleware(e,t){"sw.order.detail"===t.name&&t.children.push({component:"buckaroo-payment-detail",name:"buckaroo.payment.detail",isChildren:!0,path:"/sw/order/buckaroo/detail/:id"}),e(t)},routes:{config:{component:"buckaroo-payment-config",path:":namespace/payment/:paymentCode",name:"buckaroo.config.payment",meta:{parentPath:"sw.extension.config"},props:{default(e){return{namespace:e.params.namespace}}}}}}),a(444),a(60);let{Component:y}=Shopware;y.register("buckaroo-afterpay-old-tax",{template:'<div>\n    <a style="margin-bottom:10px;" @click="showTaxes = !showTaxes">{{$tc(\'buckaroo-payment.afterpay.setup\')}}</a>\n    <div v-if="showTaxes" style="padding: 10px;background: rgb(246 246 246); margin-bottom:10px;">\n        <div class="tax" v-for="tax in taxes">\n            <sw-select-field\n            :label="tax.name"\n            label-property="name"\n            value-property="id"\n            :options="afterpayTaxes"\n            @change="(value) => setTaxAssociation(tax.id, value)"\n            @input="(value) => setTaxAssociation(tax.id, value)"\n            @update:value="(value) => setTaxAssociation(tax.id, value)"\n            :value="getSelectValue(tax.id)"\n            ></sw-select-field>\n        </div>\n    </div>\n</div>',inject:["BuckarooPaymentSettingsService"],data(){return{taxes:[],showTaxes:!1,afterpayTaxes:[{name:this.$tc("buckaroo-payment.afterpay.hightTaxes"),id:1},{name:this.$tc("buckaroo-payment.afterpay.middleTaxes"),id:5},{name:this.$tc("buckaroo-payment.afterpay.lowTaxes"),id:2},{name:this.$tc("buckaroo-payment.afterpay.zeroTaxes"),id:3},{name:this.$tc("buckaroo-payment.afterpay.noTaxes"),id:4}],taxAssociation:{}}},model:{prop:"value",event:"change"},computed:{},props:{name:{type:String,required:!0,default:""},value:{type:Object,required:!1,default(){return{}}}},created(){this.BuckarooPaymentSettingsService.getTaxes().then(e=>{this.taxes=e.taxes.map(e=>({id:e.id,name:e.name}))})},methods:{setTaxAssociation(e,t){try{let a=t;t&&"object"==typeof t&&(t.target?a=t.target.value:t.hasOwnProperty("value")?a=t.value:t.hasOwnProperty("id")&&(a=t.id)),this.taxAssociation[e]=a,this.$emit("change",{...this.value,...this.taxAssociation})}catch(e){console.error("Error in setTaxAssociation:",e)}},getSelectValue(e){if(this.value[e])return this.value[e]}}});let{Component:f}=Shopware;f.register("buckaroo-main-config",{template:'<div>\n    <buckaroo-config-card\n            :card="mainCard"\n            :methods="elementMethods"\n            :isNotDefaultSalesChannel="isNotDefaultSalesChannel"\n            :value="value"\n            :currentSalesChannelId="currentSalesChannelId"\n            @input="onInput"\n            v-if="mainCard && value">\n    </buckaroo-config-card>\n\n    <buckaroo-payment-list\n        v-if="selectedCard === \'general\'"\n        :configSettings="configSettings"\n        :currentSalesChannelId="currentSalesChannelId"\n        :value="value"\n        @input="onInput">\n    </buckaroo-payment-list>\n</div>',props:{configSettings:{type:Array,required:!1,default:()=>[]},value:{type:Object,required:!1,default:()=>({})},elementMethods:{type:Object,required:!1,default:()=>({})},isNotDefaultSalesChannel:{type:Boolean,required:!1,default:!1},currentSalesChannelId:{type:String,required:!1,default:null}},emits:["input"],model:{prop:"value",event:"input"},data(){return{selectedCard:this.$route.params?.paymentCode||"general"}},watch:{value:{handler(e,t){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0,immediate:!0},$route(e){e.params?.paymentCode&&(this.selectedCard=e.params.paymentCode)}},computed:{mainCard(){return this.configSettings.filter(e=>e.name===this.selectedCard)?.pop()}},methods:{onInput(e){this.$emit("input",e)}}});let{Component:b}=Shopware;b.register("buckaroo-config-card",{template:'{% block buckaroo_config_card %}\n    <sw-card position-identifier="xxsw-system-config-content" v-if="card">\n        <template #title>\n            {{ getInlineSnippet(card.title) || \'Configuration\' }}\n        </template>\n\n        <div v-for="element in (card.elements || [])" :key="element.name">\n            <div v-if="canShow(element)">\n                <slot name="card-element" v-bind="{ element: getElementBind(element), config: value, card }">\n                    <sw-inherit-wrapper\n                            :value="getValueForName(element.name.replace(\'BuckarooPayments.config.\', \'\'))"\n                            v-bind="getInheritWrapperBind(element)"\n                            :has-parent="isNotDefaultSalesChannel"\n                            :inherited-value="getInheritedValue(element)"\n                            :class="\'sw-system-config--field-\' + kebabCase(getElementBind(element).name)"\n                            @input="onFieldInput(element.name, $event)"\n                    >\n                        <template #content="props">\n                            <sw-form-field-renderer\n                                    v-bind="getElementBind(element, props)"\n                                    :key="props.isInheritField + props.isInherited"\n                                    :disabled="props.isInherited"\n                                    :value="props.currentValue"\n                                    :error="getFieldError(element.name)"\n                                    @input="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\n                                    @change="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\n                                    @update:value="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\n                            />\n                        </template>\n                    </sw-inherit-wrapper>\n                </slot>\n            </div>\n        </div>\n\n        <buckaroo-test-credentials\n                v-if="canShowCredentialTester"\n                :config="value"\n                :currentSalesChannelId="currentSalesChannelId"\n        />\n    </sw-card>\n{% endblock %}\n',mounted(){this.$nextTick(()=>{this.$forceUpdate()})},watch:{value:{handler(){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0,immediate:!0},currentSalesChannelId:{handler(e,t){e!==t&&this.$nextTick(()=>{this.$forceUpdate()})},immediate:!1}},computed:{canShowCredentialTester(){let e=this.getValueForName("websiteKey"),t=this.getValueForName("secretKey");return this.card?.name==="general"&&(null!=e&&""!==e||null!=t&&""!==t)},hasValidConfigData(){return this.value&&"object"==typeof this.value&&Object.keys(this.value).length>0},reactiveValue(){return this.value}},emits:["input"],model:{prop:"value",event:"input"},props:{card:{type:Object,required:!1,default:()=>({elements:[]})},methods:{type:Object,required:!0},isNotDefaultSalesChannel:{type:Boolean,required:!0},currentSalesChannelId:{type:String,required:!0},value:{type:Object,required:!1,default:()=>({})}},methods:{getElementBind(e,t={}){if(!this.methods||!this.methods.getElementBind)return{name:e.name,type:e.type||"text",config:e.config||{},value:this.getValueForName(e.name.replace("BuckarooPayments.config.",""))};let a=this.methods.getElementBind(e,t),n=e.name.replace("BuckarooPayments.config.",""),i=this.getValueForName(n);return a.value=i,a},getInheritWrapperBind(e){if(!this.methods||!this.methods.getInheritWrapperBind){let t=e.name.replace("BuckarooPayments.config.","");return{name:e.name,currentValue:this.getValueForName(t)}}let t=this.methods.getInheritWrapperBind(e),a=e.name.replace("BuckarooPayments.config.",""),n=this.getValueForName(a);return t.currentValue=n,t},getFieldError(e){return this.methods&&this.methods.getFieldError?this.methods.getFieldError(e):null},kebabCase(e){return this.methods&&this.methods.kebabCase?this.methods.kebabCase(e):e?e.toLowerCase().replace(/[A-Z]/g,"-$&").replace(/^-/,""):""},getInlineSnippet(e){try{if("object"==typeof e&&null!==e){let t=this.$i18n?.locale||"en-GB";if(e[t])return e[t];if(e["en-GB"])return e["en-GB"];let a=Object.keys(e)[0];if(a&&e[a])return e[a];return JSON.stringify(e)}if("string"==typeof e){if(this.$t&&"function"==typeof this.$t)return this.$t(e);return e}return String(e)}catch(t){return console.warn("Translation error for:",e,t),"object"==typeof e?JSON.stringify(e):String(e)}},getInheritedValue(e){return this.methods&&this.methods.getInheritedValue?this.methods.getInheritedValue(e):null},getValueForName(e){let t;let a=this.reactiveValue;if(!a||"object"!=typeof a)return null;let n=[`BuckarooPayments.config.${e}`,e.toLowerCase(),e.charAt(0).toLowerCase()+e.slice(1),e.charAt(0).toUpperCase()+e.slice(1)];for(let e of n)if(void 0!==a[e]){t=a[e];break}if(void 0===t&&a["BuckarooPayments.config"]&&"object"==typeof a["BuckarooPayments.config"]){for(let e of n)if(void 0!==a["BuckarooPayments.config"][e]){t=a["BuckarooPayments.config"][e];break}}return t&&"object"==typeof t&&t.hasOwnProperty("_value")&&(t=t._value),t},canShow(e){if(!e||!e.name)return!1;let t=e.name.replace("BuckarooPayments.config.","");return["orderStatus","paymentSuccesStatus","automaticallyCloseOpenOrders","sendInvoiceEmail"].includes(t)?!!this.getValueForName("advancedConfiguration"):"idealprocessingRenderMode"===t?!!this.getValueForName("idealprocessingShowissuers"):"idealRenderMode"===t?!!this.getValueForName("idealShowissuers"):["idealFastCheckoutEnabled","idealFastCheckoutVisibility","idealFastCheckoutLogoScheme"].includes(t)?!!this.getValueForName("idealFastCheckout"):"afterpayPaymentstatus"===t?!!this.getValueForName("afterpayCaptureonshippent"):"afterpayOldtax"!==t||!!this.getValueForName("afterpayEnabledold")},onInput(e){this.$emit("input",e)},onFieldInput(e,t){try{let a=t;if(t&&"object"==typeof t){if(t.target){let e=t.target;a="checkbox"===e.type||"radio"===e.type?e.checked:("SELECT"===e.tagName||"select-one"===e.type||"select-multiple"===e.type)&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}else if(t.hasOwnProperty("value"))a=t.value;else if(t.hasOwnProperty("id")&&t.hasOwnProperty("name"))a=t.id;else if(Array.isArray(t)){let e=t.filter(e=>"string"==typeof e&&1===e.length).length,n=t.some(e=>","===e);if(t.some(e=>"string"==typeof e&&e.length>1),e>10&&n){let e=t.filter(e=>"string"==typeof e&&e.length>1),n=t.filter(e=>"string"==typeof e&&1===e.length).join(""),i=[];n.includes(",")?i=n.split(",").map(e=>e.trim()).filter(e=>e.length>0):n.length>0&&(i=[n]),a=[...i,...e].filter(e=>e&&e.length>0)}else a=t.filter(e=>!(null==e||""===e||"string"==typeof e&&1===e.length||"string"==typeof e&&(e.startsWith("+")||/^\d+$/.test(e)))).map(e=>"object"==typeof e&&null!==e&&(e.id||e.value||e.code||e.key)||e)}else for(let e of["id","value","key","code"])if(void 0!==t[e]){a=t[e];break}}else"boolean"==typeof t?a=t:("string"==typeof t||"number"==typeof t)&&(a=t);"on"===a?a=!0:"off"===a&&(a=!1);let n=e.replace("BuckarooPayments.config.",""),i={...this.value};i[n]=a,i[e]=a,this.$emit("input",i)}catch(e){console.error("Error in onFieldInput:",e),console.error("Error details:",e.stack)}}}}),a(572);let{Component:k,Filter:v}=Shopware;k.register("buckaroo-payment-list",{template:'<sw-card\n    position-identifier="bk-config-payment-list"\n    :title="$tc(\'buckaroo-payment.payment-methods\')"\n>\n<div class="bk-payment-wrap">\n <template\n    v-for="payment in payments" >\n    <div class="bk-payment">\n        <div class="bk-payment-inner">\n        <router-link  :title="$tc(\'buckaroo-payment.configure-payment\')" :to="{name: \'buckaroo.payment.config\', params: {namespace: \'BuckarooPayments\', paymentCode: payment.code } }">\n            <div class="bk-payment-img">\n                <img :src="assetFilter(`buckaroopayments/static/${payment.logo}`)" alt="Payment logo">\n            </div>\n            <div class="bk-payment-name">\n                {{ getPaymentTitle(payment.code) }}\n            </div>\n        </router-link>\n\n        <buckaroo-toggle-status\n            :currentSalesChannelId="currentSalesChannelId"\n            :method="payment.code"\n            :value="value"\n            @input="$emit(\'input\', $event)"\n        />\n\n        <router-link class="bk-link" :title="$tc(\'buckaroo-payment.configure-payment\')" :to="{name: \'buckaroo.payment.config\', params: {namespace: \'BuckarooPayments\', paymentCode: payment.code } }">\n            {{$tc(\'buckaroo-payment.configure-link\')}}\n        </router-link>\n        </div>\n    </div>\n </template>\n </div>\n</sw-card>',props:{configSettings:{type:Array,required:!1,default:()=>[]},value:{type:Object,required:!1,default:()=>({})},currentSalesChannelId:{type:String,required:!0}},emits:["input"],data(){return{payments:[{code:"Alipay",logo:"alipay.svg"},{code:"applepay",logo:"applepay.svg"},{code:"bancontactmrcash",logo:"bancontact.svg"},{code:"blik",logo:"blik.svg"},{code:"belfius",logo:"belfius.svg"},{code:"Billink",logo:"billink.svg"},{code:"creditcard",logo:"creditcards.svg"},{code:"creditcards",logo:"creditcards.svg"},{code:"eps",logo:"eps.svg"},{code:"giftcards",logo:"giftcards.svg"},{code:"idealqr",logo:"ideal-qr.svg"},{code:"ideal",logo:"ideal.svg"},{code:"capayable",logo:"in3.svg"},{code:"KBCPaymentButton",logo:"kbc.svg"},{code:"klarnakp",logo:"klarna.svg"},{code:"knaken",logo:"gosettle.svg"},{code:"mbway",logo:"mbway.svg"},{code:"multibanco",logo:"multibanco.svg"},{code:"paybybank",logo:"paybybank.svg"},{code:"payconiq",logo:"payconiq.svg"},{code:"paypal",logo:"paypal.svg"},{code:"payperemail",logo:"payperemail.svg"},{code:"Przelewy24",logo:"przelewy24.svg"},{code:"afterpay",logo:"afterpay.svg"},{code:"sepadirectdebit",logo:"sepa-directdebit.svg"},{code:"transfer",logo:"sepa-credittransfer.svg"},{code:"Trustly",logo:"trustly.svg"},{code:"WeChatPay",logo:"wechatpay.svg"}]}},methods:{getPaymentTitle(e){if(this.configSettings&&Array.isArray(this.configSettings)){let t=this.configSettings.find(t=>t.name===e);if(t&&t.title)try{if("object"==typeof t.title&&null!==t.title){let e=this.$i18n?.locale||"en-GB";if(t.title[e])return t.title[e];if(t.title["en-GB"])return t.title["en-GB"];let a=Object.keys(t.title)[0];if(a&&t.title[a])return t.title[a];return JSON.stringify(t.title)}if("string"==typeof t.title){if(this.$t&&"function"==typeof this.$t)return this.$t(t.title);return t.title}return String(t.title)}catch(e){return console.warn("Translation error for:",t.title,e),"object"==typeof t.title?JSON.stringify(t.title):String(t.title)}}let t=this.payments.find(t=>t.code===e);return t?t.code:"Unknown Payment"},assetFilter(e){return v.getByName("asset")(e)}}});let{Component:w}=Shopware;w.register("buckaroo-test-credentials",{template:'    <sw-button @click="sendTestApi" :disabled="!enabled" variant="primary" :square="false" :block="true" :isLoading="isLoading">{{ $tc(\'buckaroo-payment.button.labelTestApi\') }}</sw-button>',mixins:[Shopware.Mixin.getByName("notification")],data(){return{isLoading:!1}},inject:["BuckarooPaymentSettingsService"],props:{config:{type:Object,required:!0},currentSalesChannelId:{required:!0}},computed:{enabled:function(){return(this.getConfigValue("websiteKey")||"").length>0&&(this.getConfigValue("secretKey")||"").length>0}},methods:{getConfigValue:function(e){return this.config["BuckarooPayments.config."+e]},sendTestApi(){this.isLoading=!0;let e=this.getConfigValue("websiteKey"),t=this.getConfigValue("secretKey");this.BuckarooPaymentSettingsService.getApiTest(e,t,this.currentSalesChannelId).then(e=>{this.isLoading=!1,"success"==e.status?this.createNotificationSuccess({title:this.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:this.$tc(e.message)}):this.createNotificationError({title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:this.$tc(e.message)})}).catch(()=>{this.isLoading=!1})}}}),a(284);let{Component:_}=Shopware;_.register("buckaroo-toggle-status",{template:'<div class="bk-toogle-wrap">\n    <button\n            type="button"\n            :disabled="isLoading"\n            :class="`live ${getClass(\'live\')}`"\n            @click="setStatus(\'live\')"\n    >\n        Live\n    </button>\n\n    <button\n            v-if="method !== \'idealqr\'"\n            type="button"\n            :disabled="isLoading"\n            :class="`test ${getClass(\'test\')}`"\n            @click="setStatus(\'test\')"\n    >\n        Test\n    </button>\n\n    <button\n            type="button"\n            :disabled="isLoading"\n            :class="`disabled ${getClass(\'disabled\')}`"\n            @click="setStatus(\'disabled\')"\n    >\n        Off\n    </button>\n</div>\n',props:{method:{type:String,required:!0},value:{required:!0},currentSalesChannelId:{required:!0}},emits:["input"],inject:["systemConfigApiService"],data(){return{status:"disabled",isLoading:!1}},mounted(){this.status=this.getStatus()},watch:{value:{handler(e){this.status=this.getStatus()},deep:!0,immediate:!0}},methods:{getStatus(){let e=this.isActive(),t=this.getEnvironment();return e?t:"disabled"},isActive(){let e=this.getValueForName(`${this.method}Enabled`);return"string"==typeof e?"true"===e.toLowerCase():!!e},getEnvironment(){let e=this.getValueForName(`${this.method}Environment`);return null==e||""===e?"test":["test","live"].includes(e)?e:"test"},getValueForName(e){let t;let a=`BuckarooPayments.config.${e}`;if(!this.value||"object"!=typeof this.value)return null;if(void 0!==this.value[a])t=this.value[a];else if(void 0!==this.value[e])t=this.value[e];else if(this.value["BuckarooPayments.config"]&&"object"==typeof this.value["BuckarooPayments.config"])void 0!==this.value["BuckarooPayments.config"][e]&&(t=this.value["BuckarooPayments.config"][e]);else for(let a of[e,e.toLowerCase(),e.charAt(0).toLowerCase()+e.slice(1),e.charAt(0).toUpperCase()+e.slice(1)]){let e=`BuckarooPayments.config.${a}`;if(void 0!==this.value[e]){t=this.value[e];break}if(void 0!==this.value[a]){t=this.value[a];break}}return t&&"object"==typeof t&&t.hasOwnProperty("_value")&&(t=t._value),t},setStatus(e){this.status=e,this.saveStatus()},getClass(e){return this.status===e?"active":""},async saveStatus(){let e=`BuckarooPayments.config.${this.method}Enabled`,t=`BuckarooPayments.config.${this.method}Environment`,a={[e]:!1},n={...this.value};n[e]=!1,-1!==["live","test"].indexOf(this.status)&&(a={[e]:!0,[t]:this.status},n[e]=!0,n[t]=this.status),this.$emit("input",n),this.isLoading=!0;try{await this.systemConfigApiService.batchSave({[this.currentSalesChannelId]:a}).finally(()=>{this.isLoading=!1}),this.renderSuccess()}catch(e){this.renderError(e)}},renderSuccess(){this.$store.dispatch("notification/createNotification",{variant:"success",message:this.$tc("sw-extension-store.component.sw-extension-config.messageSaveSuccess")})},renderError(e){this.$store.dispatch("notification/createNotification",{variant:"error",message:e})}}})}()})();