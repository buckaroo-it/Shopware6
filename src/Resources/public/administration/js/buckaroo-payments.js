!function(){var e={762:function(){},908:function(){},425:function(){},964:function(){let{ApiService:e}=Shopware.Classes;class t extends e{constructor(e,t,n="buckaroo"){super(e,t,n)}getBasicHeaders(){return this.loginService&&"function"==typeof this.loginService.getToken?super.getBasicHeaders():{"Content-Type":"application/json",Accept:"application/json"}}getSupportVersion(){let t=`_action/${this.getApiBasePath()}/version`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}getTaxes(){let t=`_action/${this.getApiBasePath()}/taxes`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}getIn3Icons(){let t=`_action/${this.getApiBasePath()}/in3/logos`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}getApiTest(t,n,a){let r=`_action/${this.getApiBasePath()}/getBuckarooApiTest`;return this.httpClient.post(r,{websiteKeyId:t,secretKeyId:n,saleChannelId:a},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}}Shopware.Service().register("BuckarooPaymentSettingsService",()=>{let e=Shopware.Application.getContainer("init"),n=Shopware.Service("loginService");return new t(e.httpClient,n)})},442:function(){let{ApiService:e}=Shopware.Classes;class t extends e{constructor(e,t,n="buckaroo"){super(e,t,n)}getBasicHeaders(){return this.loginService&&"function"==typeof this.loginService.getToken?super.getBasicHeaders():{"Content-Type":"application/json",Accept:"application/json"}}getBuckarooTransaction(t){let n=`_action/${this.getApiBasePath()}/getBuckarooTransaction`;return this.httpClient.post(n,{transaction:t},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}refundPayment(t,n,a,r){let i=`_action/${this.getApiBasePath()}/refund`;return this.httpClient.post(i,{transaction:t,transactionsToRefund:n,orderItems:a,customRefundAmount:r},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}captureOrder(t){let n=`_action/${this.getApiBasePath()}/capture`;return this.httpClient.post(n,{transaction:t},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}createPaylink(t){let n=`_action/${this.getApiBasePath()}/paylink`;return this.httpClient.post(n,{transaction:t},{headers:this.getBasicHeaders()}).then(t=>e.handleResponse(t))}}Shopware.Service().register("BuckarooPaymentService",()=>{let e=Shopware.Application.getContainer("init"),n=Shopware.Service("loginService");return new t(e.httpClient,n)})},403:function(){let{Component:e}=Shopware;e.extend("buckaroo-payment-config","sw-extension-config",{})},345:function(e,t,n){var a=n(762);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,n(534).A)("6edb27f6",a,!0,{})},177:function(e,t,n){var a=n(908);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,n(534).A)("1cc6b8ba",a,!0,{})},510:function(e,t,n){var a=n(425);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,n(534).A)("b317cfbc",a,!0,{})},534:function(e,t,n){"use strict";function a(e,t){for(var n=[],a={},r=0;r<t.length;r++){var i=t[r],o=i[0],s={id:e+":"+r,css:i[1],media:i[2],sourceMap:i[3]};a[o]?a[o].parts.push(s):n.push(a[o]={id:o,parts:[s]})}return n}n.d(t,{A:function(){return h}});var r,i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},s=i&&(document.head||document.getElementsByTagName("head")[0]),l=null,c=0,u=!1,d=function(){},p=null,m="data-vue-ssr-id",g="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function h(e,t,n,r){u=n,p=r||{};var i=a(e,t);return f(i),function(t){for(var n=[],r=0;r<i.length;r++){var s=o[i[r].id];s.refs--,n.push(s)}t?f(i=a(e,t)):i=[];for(var r=0;r<n.length;r++){var s=n[r];if(0===s.refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete o[s.id]}}}}function f(e){for(var t=0;t<e.length;t++){var n=e[t],a=o[n.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](n.parts[r]);for(;r<n.parts.length;r++)a.parts.push(b(n.parts[r]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{for(var i=[],r=0;r<n.parts.length;r++)i.push(b(n.parts[r]));o[n.id]={id:n.id,refs:1,parts:i}}}}function y(){var e=document.createElement("style");return e.type="text/css",s.appendChild(e),e}function b(e){var t,n,a=document.querySelector("style["+m+'~="'+e.id+'"]');if(a){if(u)return d;a.parentNode.removeChild(a)}if(g){var r=c++;t=v.bind(null,a=l||(l=y()),r,!1),n=v.bind(null,a,r,!0)}else t=w.bind(null,a=y()),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){a?(a.css!==e.css||a.media!==e.media||a.sourceMap!==e.sourceMap)&&t(e=a):n()}}var k=(r=[],function(e,t){return r[e]=t,r.filter(Boolean).join("\n")});function v(e,t,n,a){var r=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=k(t,r);else{var i=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function w(e,t){var n=t.css,a=t.media,r=t.sourceMap;if(a&&e.setAttribute("media",a),p.ssrId&&e.setAttribute(m,t.id),r&&(n+="\n/*# sourceURL="+r.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={id:a,exports:{}};return e[a](i,i.exports,n),i.exports}n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="bundles/buckaroopayments/",window?.__sw__?.assetPath&&(n.p=window.__sw__.assetPath+"/bundles/buckaroopayments/"),function(){"use strict";let{Component:e,Context:t}=Shopware,a=Shopware.Data.Criteria;e.override("sw-order-detail",{template:'{% block sw_order_detail_content_tabs %}\r\n    <div\r\n     v-if="isPaymentInTestMode && setIsBuckarooPayment"\r\n     style="max-width: 960px; margin: 0 auto 15px; background: rgb(251, 227, 231); border-radius:4px; color: #de294c; display:flex; align-items:center;">\r\n        <div style="background:#de294c;padding: 4px 8px;border-radius: 4px 0 0 4px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="m13.7744 1.4124 9.7058 18.6649c.5096.98.1283 2.1875-.8517 2.6971a2 2 0 0 1-.9227.2256H2.2942c-1.1045 0-2-.8954-2-2a2 2 0 0 1 .2256-.9227l9.7058-18.665c.5096-.98 1.7171-1.3613 2.6971-.8517a2 2 0 0 1 .8517.8518zM2.2942 21h19.4116L12 2.335 2.2942 21zM12 17c.5523 0 1 .4477 1 1s-.4477 1-1 1-1-.4477-1-1 .4477-1 1-1zm1-2c0 .5523-.4477 1-1 1s-1-.4477-1-1v-5c0-.5523.4477-1 1-1s1 .4477 1 1v5z" id="icons-default-warning"></path></defs><use xlink:href="#icons-default-warning" fill="#fff" fill-rule="evenodd"></use></svg></div>\r\n        <p style="margin-left:10px;">{{ $tc(\'buckaroo-payment.paymentInTestMode\') }}</p>\r\n    </div>\r\n    {% parent %}\r\n{% endblock %}\r\n\r\n\r\n{% block sw_order_detail_content_tabs_general %}\r\n    {% parent %}\r\n\r\n    <sw-tabs-item v-if="setIsBuckarooPayment" :route="{ name: \'buckaroo.payment.detail\', params: { id: $route.params.id } }" :title="$tc(\'buckaroo-payment.tabs.title\')">\r\n        {{ $tc(\'buckaroo-payment.tabs.title\') }}\r\n    </sw-tabs-item>\r\n    \r\n{% endblock %}\r\n\r\n{% block sw_order_detail_actions %}\r\n    <template v-if="isEditable">\r\n    </template>\r\n    {% parent %}\r\n{% endblock %}',data(){return{isBuckarooPayment:!1,isPaymentInTestMode:!1}},computed:{isEditable(){return!this.isBuckarooPayment||"buckaroo.payment.detail"!==this.$route.name},showTabs(){return!0}},watch:{orderId:{deep:!0,handler(){if(!this.orderId){this.setIsBuckarooPayment(null);return}let e=this.repositoryFactory.create("order"),n=new a(1,1);n.addAssociation("transactions"),e.get(this.orderId,t.api,n).then(e=>{if(this.setPaymentInTestMode(e),e.transactions.length<=0||!e.transactions.last().paymentMethodId){this.setIsBuckarooPayment(null);return}let t=e.transactions.last().paymentMethodId;null!=t&&this.setIsBuckarooPayment(t)})},immediate:!0}},methods:{setPaymentInTestMode(e){e.customFields&&e.customFields.buckaroo_payment_in_test_mode&&(this.isPaymentInTestMode=!0===e.customFields.buckaroo_payment_in_test_mode)},setIsBuckarooPayment(e){e&&this.repositoryFactory.create("payment_method").get(e,t.api).then(e=>{this.isBuckarooPayment=e.formattedHandlerIdentifier.indexOf("buckaroo")>=0})}}});let{Component:r,Context:i}=Shopware;Shopware.Data.Criteria,r.override("sw-order-detail-base",{template:'{% block sw_order_detail_base_line_items_summary %}\r\n\r\n    <sw-card-section divider="top" secondary slim v-if="order.customFields !== null">\r\n        <sw-container columns="1fr 440px"\r\n        class="sw-order-detail__summary" v-if="order.customFields.buckarooFee !== null && order.customFields.buckarooFee > 0">\r\n            <sw-description-list grid="265px 1fr"\r\n            class="sw-order-detail__summary-data">\r\n                <dt>{{ $tc(\'buckaroo-payment.fee\') }}</dt>\r\n                <dd>{{ order.customFields.buckarooFee }}\r\n                    {% if order.currency.isoCode == "PLN" %}\r\n                        PLN\r\n                    {% else %}\r\n                        {{ order.currency.symbol }}\r\n                    {% endif %}\r\n                    </dd>\r\n            </sw-description-list>\r\n        </sw-container>\r\n    </sw-card-section>\r\n\r\n    {% parent %}\r\n    \r\n{% endblock %}'});let{Component:o}=Shopware;o.override("sw-order-user-card",{template:"{% block sw_order_detail_base_secondary_info_payment %}\r\n    <template v-if=\"currentOrder.transactions.length > 0 && (!currentOrder.transactions.last().paymentMethod.translated.customFields || !currentOrder.transactions.last().paymentMethod.translated.customFields.is_buckaroo)\">\r\n        {% parent %}\r\n    </template>\r\n    <template v-if=\"currentOrder.transactions.length > 0 && currentOrder.transactions.last().paymentMethod.translated.customFields && currentOrder.transactions.last().paymentMethod.translated.customFields.is_buckaroo\">\r\n        <dt>{{ $tc('sw-order.detailBase.labelPaymentMethod') }}</dt>\r\n        <dd>\r\n            <template v-if=\"config['BuckarooPayments.config.' + currentOrder.transactions.last().paymentMethod.translated.customFields.buckaroo_key + 'Label']\">\r\n                {{ config['BuckarooPayments.config.' + currentOrder.transactions.last().paymentMethod.translated.customFields.buckaroo_key + 'Label'] }}\r\n            </template>\r\n        </dd>\r\n    </template>\r\n{% endblock %}\r\n\r\n",inject:["systemConfigApiService"],data(){return{config:{}}},created(){this.systemConfigApiService.getValues("BuckarooPayments.config",null).then(e=>{this.config=e}).finally(()=>{})}});let{Component:s}=Shopware;s.override("sw-system-config",{template:' {% block sw_system_config_content_card %}\r\n    <template v-if="domain !== \'BuckarooPayments.config\'">\r\n        {% parent() %}\r\n    </template>\r\n    <template v-else>\r\n       <buckaroo-main-config\r\n            :value="actualConfigData[currentSalesChannelId]"\r\n            :configSettings="config"\r\n            :isNotDefaultSalesChannel="isNotDefaultSalesChannel"\r\n            :currentSalesChannelId="currentSalesChannelId"\r\n            :elementMethods="{getElementBind, getFieldError, getInheritWrapperBind, getInheritedValue, hasMapInheritanceSupport, getInlineSnippet, kebabCase}"\r\n            @input="onConfigDataUpdate"\r\n            v-if="!isLoading && actualConfigData[currentSalesChannelId] && config && config.length > 0"\r\n        ></buckaroo-main-config>\r\n    </template>\r\n {% endblock %}',watch:{currentSalesChannelId:{handler(e,t){e&&"BuckarooPayments.config"===this.domain&&this.loadBuckarooConfigData()},immediate:!0},domain:{handler(e){"BuckarooPayments.config"===e&&this.currentSalesChannelId&&this.loadBuckarooConfigData()},immediate:!0}},methods:{loadBuckarooConfigData(){this.systemConfigApiService.getValues("BuckarooPayments.config",this.currentSalesChannelId).then(e=>{this.actualConfigData[this.currentSalesChannelId]||(this.actualConfigData[this.currentSalesChannelId]={});let t={};e&&"object"==typeof e&&Object.keys(e).forEach(n=>{let a=e[n];a&&"object"==typeof a&&a.hasOwnProperty("_value")?t[n]=a._value:t[n]=a;let r=n.replace("BuckarooPayments.config.","");r!==n&&(t[r]=t[n])}),this.actualConfigData[this.currentSalesChannelId]={},Object.keys(t).forEach(e=>{this.actualConfigData[this.currentSalesChannelId][e]=t[e]}),this.$nextTick(()=>{this.$forceUpdate()})}).catch(e=>{console.error("Error fetching system config:",e)})},onConfigDataUpdate(e){this.actualConfigData[this.currentSalesChannelId]||(this.actualConfigData[this.currentSalesChannelId]={}),Object.keys(e).forEach(t=>{if(this.actualConfigData[this.currentSalesChannelId][t]=e[t],!t.startsWith("BuckarooPayments.config.")){let n=`BuckarooPayments.config.${t}`;this.actualConfigData[this.currentSalesChannelId][n]=e[t]}})},saveAll(){return"BuckarooPayments.config"!==this.domain?this.$super("saveAll"):this.saveBuckaroo()},saveBuckaroo(){return this.isLoading=!0,this.systemConfigApiService.batchSave(this.getSelectedValues()).finally(()=>{this.isLoading=!1})},getCurrentConfigCard(){let e=this.$route.params?.paymentCode||"general";return this.config.filter(t=>t.name===e)?.pop()},getSelectedValues(){let e=this.actualConfigData[this.currentSalesChannelId],t=this.getCurrentConfigCard();if(t?.elements){let n={};return t?.elements.forEach(t=>{if(t?.name){let a=e[t.name];void 0===a&&(a=e[t.name.replace("BuckarooPayments.config.","")]),n[t.name]=a}}),{[this.currentSalesChannelId]:n}}return this.actualConfigData}}}),n(510);let{Component:l,Filter:c,Context:u}=Shopware,d=Shopware.Data.Criteria;l.register("buckaroo-payment-detail",{template:'{% block buckaroo_payment_detail %}\r\n    <div class="buckaroo-payment-detail">\r\n        \r\n        <sw-card positionIdentifier="bk-paylink" :title="$tc(\'buckaroo-payment.paymentDetail.paylinkTitle\')" v-if="isPaylinkVisible">\r\n\r\n            {{ $tc(\'buckaroo-payment.paymentDetail.paylinkDescription\') }}\r\n            \r\n            <span v-if="paylink"> <br>\r\n            {{ $tc(\'buckaroo-payment.paymentDetail.yourLink\') }}: <a :href="paylink">{{ paylink }}</a>\r\n            </span>\r\n\r\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\r\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt> <dd>\r\n            \r\n                        <sw-button @click="createPaylink(orderId)" :disabled="!isPaylinkAvailable">\r\n                            {{ $tc(\'buckaroo-payment.paymentDetail.paylinkButton\') }}\r\n                        </sw-button></dd>\r\n                </sw-description-list>\r\n            </sw-container>\r\n\r\n        </sw-card>\r\n\r\n         <sw-card positionIdentifier="bk-refund" :title="$tc(\'buckaroo-payment.paymentDetail.refundTitle\')">\r\n            \r\n            {{ $tc(\'buckaroo-payment.orderItems.title\') }}\r\n            <sw-data-grid :dataSource="orderItems"\r\n                :columns="orderItemsColumns"\r\n                :showActions="false"\r\n                :showSelection="false">\r\n\r\n                    <template #column-name="{ item }">\r\n                        <sw-product-variant-info :showTooltip="false" :variations="item.variations">\r\n                            {{ item.name }}\r\n                        </sw-product-variant-info>\r\n                    </template>\r\n                    <template #column-quantity="{ item }">\r\n                        <input class="bk-reund-qty" type="number" min="0" :max="item.quantityMax" v-model="item.quantity" @input="recalculateOrderItems" onkeydown="return event.keyCode !== 69">\r\n                    </template>\r\n\r\n            </sw-data-grid>\r\n\r\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\r\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data">\r\n                        <dt>{{ $tc(\'buckaroo-payment.paymentDetail.amountTotalTitle\') }}: </dt>\r\n                        <dd>{{ buckaroo_refund_amount }}  {{ currency }}</dd>\r\n                </sw-description-list>\r\n            </sw-container>\r\n                 \r\n            <sw-card-section divider="top" secondary slim>\r\n                <sw-container columns="1fr 440px"\r\n                              class="sw-order-detail__summary">\r\n                </sw-container>\r\n\r\n                <sw-data-grid :dataSource="transactionsToRefund"\r\n                    :columns="transactionsToRefundColumns"\r\n                    :showHeader="false"\r\n                    :showActions="false"\r\n                    :showSelection="false">\r\n\r\n                        <template #column-transaction_method="{ item }">\r\n                                <span v-if="item.transaction_method == \'KbcPaymentButton\'">\r\n                                    Kbc\r\n                                </span>\r\n                                <span v-else>\r\n                                    {{ item.transaction_method }}\r\n                                </span>\r\n                        </template>\r\n\r\n                        <template #column-amount="{ item }">\r\n                            <input type="number" min="0" :max="item.amountMax" v-model="item.amount"  @input="recalculateRefundItems" onkeydown="return event.keyCode !== 69">\r\n                        </template>\r\n\r\n                </sw-data-grid>\r\n\r\n                <sw-container v-if="!isAuthorized" columns="1fr 440px" class="sw-order-detail__summary">\r\n                    <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data">\r\n                            <dt>{{ $tc(\'buckaroo-payment.paymentDetail.amountCustomRefundTitle\') }}: </dt>\r\n                            <dd>\r\n                                <input id="buckaroo_custom_refund_enabled" type="checkbox"\r\n                                       @click="toggleCustomRefund()">\r\n                                <input id="buckaroo_custom_refund_amount" type="number"\r\n                                       v-model="buckaroo_refund_total_amount" disabled style="width:70px;"> {{ currency }}\r\n                            </dd>\r\n                    </sw-description-list>\r\n                    <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data">\r\n                            <dt>{{ $tc(\'buckaroo-payment.paymentDetail.amountRefundTotalTitle\') }}: </dt>\r\n                            <dd>{{ buckaroo_refund_total_amount }} {{ currency }}</dd>\r\n                    </sw-description-list>\r\n                </sw-container>\r\n                 \r\n            </sw-card-section>\r\n\r\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\r\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt><dd>\r\n                    <sw-button @click="refundOrder(orderId, buckaroo_refund_amount)" :disabled="!isRefundPossible || isAuthorized">\r\n                    {{ $tc(\'buckaroo-payment.paymentDetail.buttonTitle\') }}\r\n                    </sw-button></dd>\r\n                </sw-description-list>\r\n            </sw-container>\r\n\r\n         </sw-card>\r\n\r\n        <sw-card positionIdentifier="bk-pay-desc" :title="$tc(\'buckaroo-payment.paymentDetail.payTitle\')">\r\n\r\n            {{ $tc(\'buckaroo-payment.paymentDetail.payDescription\') }}\r\n\r\n            <sw-container columns="1fr 440px" class="sw-order-detail__summary">\r\n                <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt><dd>\r\n                        <sw-button @click="captureOrder(orderId)" :disabled="!isCapturePossible">\r\n                            {{ $tc(\'buckaroo-payment.paymentDetail.payButton\') }}\r\n                        </sw-button></dd>\r\n                </sw-description-list>\r\n            </sw-container>\r\n\r\n        </sw-card>\r\n\r\n         <sw-card positionIdentifier="bk-pay-transaction" :title="$tc(\'buckaroo-payment.paymentDetail.transactionsTitle\')">\r\n            <sw-data-grid :dataSource="relatedResources"\r\n                :columns="relatedResourceColumns"\r\n                :showActions="false"\r\n                :showSelection="false">\r\n\r\n                    <template #column-transaction_method="{ item }">\r\n                            <span v-if="item.transaction_method == \'KbcPaymentButton\'">\r\n                                Kbc\r\n                            </span>\r\n                            <span v-else>\r\n                                {{ item.transaction_method }}\r\n                            </span>\r\n                    </template>\r\n\r\n            </sw-data-grid>\r\n         </sw-card>\r\n\r\n\r\n        <sw-loader v-if="isLoading">\r\n        </sw-loader>\r\n    </div>\r\n{% endblock %}',inject:["repositoryFactory","BuckarooPaymentService","systemConfigApiService"],data(){return{config:{},buckaroo_refund_amount:"0",buckaroo_refund_total_amount:"0",currency:"EUR",isRefundPossible:!0,isCapturePossible:!1,isPaylinkAvailable:!1,isPaylinkVisible:!1,paylinkMessage:"",paylink:"",isLoading:!1,order:!1,buckarooTransactions:null,orderItems:[],transactionsToRefund:[],relatedResources:[],isAuthorized:!1}},computed:{orderItemsColumns(){return[{property:"name",label:this.$tc("buckaroo-payment.orderItems.types.name"),allowResize:!1,primary:!0,inlineEdit:!0,multiLine:!0},{property:"quantity",label:this.$tc("buckaroo-payment.orderItems.types.quantity"),rawData:!0,align:"right"},{property:"totalAmount",label:this.$tc("buckaroo-payment.orderItems.types.totalAmount"),rawData:!0,align:"right"}]},transactionsToRefundColumns(){return[{property:"transaction_method",rawData:!0},{property:"amount",rawData:!0}]},relatedResourceColumns(){return[{property:"created_at",label:this.$tc("buckaroo-payment.transactionHistory.types.created_at"),rawData:!0},{property:"total",label:this.$tc("buckaroo-payment.transactionHistory.types.total"),rawData:!0},{property:"shipping_costs",label:this.$tc("buckaroo-payment.transactionHistory.types.shipping_costs"),rawData:!0},{property:"total_excluding_vat",label:this.$tc("buckaroo-payment.transactionHistory.types.total_excluding_vat"),rawData:!0},{property:"vat",label:this.$tc("buckaroo-payment.transactionHistory.types.vat"),rawData:!0},{property:"transaction_key",label:this.$tc("buckaroo-payment.transactionHistory.types.transaction_key"),rawData:!0},{property:"transaction_method",label:this.$tc("buckaroo-payment.transactionHistory.types.transaction_method"),rawData:!0},{property:"statuscode",label:this.$tc("buckaroo-payment.transactionHistory.types.statuscode"),rawData:!0}]}},created(){this.createdComponent()},methods:{recalculateOrderItems(){for(let e in this.buckaroo_refund_amount=0,this.orderItems)this.orderItems[e].totalAmount=parseFloat(parseFloat(this.orderItems[e].unitPrice)*parseFloat(this.orderItems[e].quantity||0)).toFixed(2),this.buckaroo_refund_amount=parseFloat(parseFloat(this.buckaroo_refund_amount)+parseFloat(this.orderItems[e].totalAmount)).toFixed(2)},recalculateRefundItems(){for(let e in this.buckaroo_refund_total_amount=0,this.transactionsToRefund)this.transactionsToRefund[e].amount&&(this.buckaroo_refund_total_amount=parseFloat(parseFloat(this.buckaroo_refund_total_amount)+parseFloat(this.transactionsToRefund[e].amount)).toFixed(2))},getCustomRefundEnabledEl(){return document.getElementById("buckaroo_custom_refund_enabled")},getCustomRefundAmountEl(){return document.getElementById("buckaroo_custom_refund_amount")},toggleCustomRefund(){this.getCustomRefundEnabledEl()&&this.getCustomRefundAmountEl()&&(this.getCustomRefundAmountEl().disabled=!this.getCustomRefundEnabledEl().checked)},getCustomRefundAmount(){return this.getCustomRefundEnabledEl()&&this.getCustomRefundAmountEl()&&this.getCustomRefundEnabledEl().checked?this.getCustomRefundAmountEl().value:0},createdComponent(){let e=this,t=this.$route.params.id;this.systemConfigApiService.getValues("BuckarooPayments.config",null).then(e=>{this.config=e});let n=this.repositoryFactory.create("order"),a=new d(1,1);this.orderId=t,a.addAssociation("transactions.paymentMethod").addAssociation("transactions"),a.getAssociation("transactions").addSorting(d.sort("createdAt")),n.get(t,u.api,a).then(t=>{e.checkedIsAuthorized(t),e.isCapturePossible=t.transactions&&t.transactions.last().paymentMethod&&t.transactions.last().paymentMethod.customFields&&t.transactions.last().paymentMethod.customFields.buckaroo_key&&["klarnakp","billink","afterpay"].includes(t.transactions.last().paymentMethod.customFields.buckaroo_key.toLowerCase())||e.isAfterpayCapturePossible(t),e.isPaylinkVisible=e.isPaylinkAvailable=this.getConfigValue("paylinkEnabled")&&t.stateMachineState&&t.stateMachineState.technicalName&&"open"==t.stateMachineState.technicalName&&t.transactions&&"open"==t.transactions.last().stateMachineState.technicalName}),this.BuckarooPaymentService.getBuckarooTransaction(t).then(t=>{e.orderItems=[],e.transactionsToRefund=[],e.relatedResources=[],this.$emit("loading-change",!1),t.orderItems&&Array.isArray(t.orderItems)&&t.orderItems.forEach(t=>{e.orderItems.push({id:t.id,name:t.name,quantity:t.quantity,quantityMax:t.quantity,unitPrice:t.unitPrice.value,totalAmount:t.totalAmount.value,variations:t.variations||[]})}),e.buckaroo_refund_amount=t.refundTotals?t.refundTotals.totalAmount:0,e.currency=t.refundTotals?t.refundTotals.currency:"EUR",t.transactionsToRefund&&Array.isArray(t.transactionsToRefund)&&t.transactionsToRefund.forEach(t=>{e.transactionsToRefund.push({id:t.id,transactions:t.transactions,amount:t.total,amountMax:t.total,currency:t.currency,transaction_method:t.transaction_method,logo:t.transaction_method?t.logo:null}),e.currency=t.currency}),e.recalculateRefundItems(),t.transactions&&Array.isArray(t.transactions)&&t.transactions.forEach(t=>{e.relatedResources.push({id:t.id,transaction_key:t.transaction,total:t.total,total_excluding_vat:t.total_excluding_vat,shipping_costs:t.shipping_costs,vat:t.vat,transaction_method:t.transaction_method,logo:t.transaction_method?t.logo:null,created_at:t.created_at,statuscode:t.statuscode})})}).catch(e=>{console.log("errorResponse",e)})},isAfterpayCapturePossible(e){return!0===e.customFields.buckaroo_is_authorize},checkedIsAuthorized(e){this.isAuthorized=e?.transactions?.last()?.stateMachineState?.technicalName==="authorized"},refundOrder(e,t){let n=this;n.isRefundPossible=!1,this.BuckarooPaymentService.refundPayment(e,this.transactionsToRefund,this.orderItems,this.getCustomRefundAmount()).then(e=>{for(let t in e)e[t].status?this.$store.dispatch("notification/createNotification",{variant:"success",title:n.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:n.$tc(e[t].message)+e[t].amount}):this.$store.dispatch("notification/createNotification",{variant:"error",title:n.$tc("buckaroo-payment.settingsForm.titleError"),message:n.$tc(e[t].message)});n.isRefundPossible=!0,this.createdComponent()}).catch(e=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:e.response.data.message}),n.isRefundPossible=!0})},createPaylink(e){let t=this;t.isPaylinkAvailable=!1,this.BuckarooPaymentService.createPaylink(e,this.transactionsToRefund,this.orderItems).then(e=>{e.status?(t.paylinkMessage=t.$tc(e.message)+e.paylinkhref,t.paylink=e.paylink,this.$store.dispatch("notification/createNotification",{variant:"success",title:t.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:t.paylinkMessage})):this.$store.dispatch("notification/createNotification",{variant:"error",title:t.$tc("buckaroo-payment.settingsForm.titleError"),message:t.$tc(e.message)}),t.isPaylinkAvailable=!0}).catch(e=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:e.response.data.message}),t.isPaylinkAvailable=!0})},getConfigValue(e){return this.config[`BuckarooPayments.config.${e}`]},captureOrder(e){let t=this;t.isCapturePossible=!1,this.BuckarooPaymentService.captureOrder(e,this.transactionsToRefund,this.orderItems).then(e=>{e.status?this.$store.dispatch("notification/createNotification",{variant:"success",title:t.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:e.message}):this.$store.dispatch("notification/createNotification",{variant:"error",title:t.$tc("buckaroo-payment.settingsForm.titleError"),message:e.message}),t.isCapturePossible=!0,this.createdComponent()}).catch(e=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:t.$tc(e.response.data.message)}),t.isCapturePossible=!0})}}}),n(403);var p=JSON.parse('{"buckaroo-payment":{"fee":"Buckaroo Betaaltoeslag","order":{"refundDescription":"Refund voor bestelling #orderNumber"},"general":{"title":"Buckaroo","description":"Buckaroo Payment"},"settingsForm":{"save":"Opslaan","titleSuccess":"Succes","titleError":"Foutmelding"},"supportModal":{"menuButton":"Version & Support","title":"Versie & Support","support":{"description":"Zorg ervoor dat u uw website key bij de hand heeft voordat u contact opneemt met Buckaroo technical support","label1":"Buckaroo Plaza:","label2":"Telefoonnummer:","label3":"E-mail:","label4":"Website:","your_version":"Uw PHP versie:","version":"Versie compatibiliteit","information":"Informatie"}},"tabs":{"title":"Buckaroo Payment","overview":"Overzicht"},"paymentDetail":{"yourLink":"Uw Paylink","paylinkButton":"Cre\xeber Paylink","paylinkDescription":"Cre\xeber Paylink voor order","paylinkTitle":"Paylink","refundTitle":"Terugbetaling","transactionsTitle":"Transacties","amountTitle":"Hoeveelheid","amountTotalTitle":"Algemeen totaal (grand total)","amountRefundTotalTitle":"Terugbetaling Algemeen totaal (grand total)","amountCustomRefundTitle":"Aangepast bedrag terugbetalen","buttonTitle":"Terugbetaling","successTitle":"Success","successMessage":"Buckaroo terugbetaling succesvol","errorTitle":"Foutmelding","payTitle":"Betaling vastleggen (Capture)","payDescription":"Factuur voor bestelling vastleggen (Capture) en aanmaken","payButton":"Betaling vastleggen (Capture)"},"orderItems":{"title":"Artikelen om terug te betalen","types":{"id":"id","name":"Titel","quantity":"Aantal om terug te betalen","totalAmount":"Subtotaal"}},"transactionsToRefund":{"title":"Terugbetaling Totaal"},"transactionHistory":{"types":{"id":"id","created_at":"Datum/tijd","total":"Totaal","shipping_costs":"Verzendkosten","total_excluding_vat":"Totaal exclusief BTW","total_including_vat":"Totaal inclusief BTW","vat":"BTW","transaction_key":"Transactie key","transaction_method":"Betaalmethode","statuscode":"Status"}},"messageNotValid":"Dit veld is niet geldig.","messageNotBlank":"Dit veld mag niet leeg zijn.","button":{"labelTestApi":"Test gegevens"},"afterpay":{"setup":"Belastingkoppeling instellen voor Riverty old ","hightTaxes":"Hoge BTW-heffingen","middleTaxes":"Middelmatige BTW-belastingen","lowTaxes":"Lage BTW-heffingen","zeroTaxes":"Nul VAT","noTaxes":"Geen BTW"},"paymentInTestMode":"De betaling voor deze bestelling is in testmodus uitgevoerd","refund":{"not_supported":"Terugbetaling wordt niet ondersteund","already_refunded":"Deze bestelling is al terugbetaald","refunded_amount":"Buckaroo terugbetaling succesvol"},"test_api":{"connection_ready":"Verbinding gereed","connection_failed":"Verbinding mislukt"},"paylink":{"invalid_amount":"Het bedrag is niet geldig","pay_link":"Uw Paylink:"},"missing_order_id":"Ontbrekende bestelling orderId","missing_transaction":"Order transactie niet gevonden","general_request_error":"Helaas is er een fout opgetreden tijdens het verwerken van uw aanvraag. Probeer het opnieuw.","in3LogoLabel":"Betaalmethode Logo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}}'),m=JSON.parse('{"buckaroo-payment":{"fee":"Buckaroo Geb\xfchr","order":{"refundDescription":"R\xfcckerstattung f\xfcr Bestellung #orderNumber"},"general":{"title":"Buckaroo","description":"Buckaroo Zahlung"},"settingsForm":{"save":"Speichern","titleSuccess":"Erfolg","titleError":"Fehler"},"supportModal":{"menuButton":"Version & Unterst\xfctzung","title":"Version & Unterst\xfctzung","support":{"description":"Bevor Sie den technischen Support von Buckaroo kontaktieren, bitte holen Sie Ihren (H\xe4ndler-)Schl\xfcssel und Geheimschl\xfcssel ab.","label1":"Buckaroo Plaza:","label2":"Telefon:","label3":"E-Mail:","label4":"Webseite:","your_version":"Ihre PHP-Version:","version":"Versionskompatibilit\xe4t","information":"Informationen"}},"tabs":{"title":"Buckaroo Payment","overview":"\xdcbersicht"},"paymentDetail":{"yourLink":"Ihr Paylink","paylinkButton":"Paylink erstellen","paylinkDescription":"Paylink erstellen f\xfcr Bestellung","paylinkTitle":"Paylink","refundTitle":"R\xfcckerstattung","transactionsTitle":"Transaktionen","amountTitle":"Betrag","amountTotalTitle":"Gesamtsumme","amountRefundTotalTitle":"Gesamtsumme der R\xfcckerstattung","amountCustomRefundTitle":"R\xfcckerstattung individueller Betrag","buttonTitle":"R\xfcckerstattung","successTitle":"Erfolg","successMessage":"Buckaroo-Erfolg, zur\xfcckerstattet","errorTitle":"Fehler","payTitle":"Zahlung erfassen (Capture)","payDescription":"Erfassen (Capture) und Rechnung f\xfcr Bestellung erstellen","payButton":"Zahlung erfassen (Capture)"},"orderItems":{"title":"Artikel zur R\xfcckerstattung","types":{"id":"id","name":"Titel","quantity":"Menge zur R\xfcckerstattung","totalAmount":"Teilsumme"}},"transactionsToRefund":{"title":"R\xfcckerstattungssummen"},"transactionHistory":{"types":{"id":"id","created_at":"Datum/Uhrzeit","total":"Gesamt","shipping_costs":"Versandkosten","total_excluding_vat":"Gesamt ohne MwSt. (VAT)","total_including_vat":"Gesamt inklusive MwSt. (VAT)","vat":"MwSt. (VAT)","transaction_key":"Transaktionsschl\xfcssel","transaction_method":"Zahlungsmethode","statuscode":"Status"}},"messageNotValid":"Dieses Feld ist nicht g\xfcltig.","messageNotBlank":"Dieses Feld darf nicht leer sein.","button":{"labelTestApi":"Verbindung testen"},"afterpay":{"setup":"Steuerzuordnung f\xfcr Riverty old einrichten ","hightTaxes":"Hohe MwSt. (VAT)","middleTaxes":"Mittlere MwSt. (VAT)","lowTaxes":"Niedrige MwSt. (VAT)","zeroTaxes":"Keine MwSt. (VAT)","noTaxes":"Keine Mehrwertsteuer"},"paymentInTestMode":"Die Zahlung f\xfcr diese Bestellung wurde im Testmodus durchgef\xfchrt","refund":{"not_supported":"R\xfcckerstattung wird nicht unterst\xfctzt","already_refunded":"Diese Bestellung wurde bereits zur\xfcckerstattet","refunded_amount":"Erfolgreich von Buckaroo erstattet"},"test_api":{"connection_ready":"Verbindung bereit","connection_failed":"Verbindung fehlgeschlagen"},"paylink":{"invalid_amount":"Betrag ist nicht g\xfcltig","pay_link":"Ihr Zahlungslink (Paylink):"},"missing_order_id":"Fehlende Bestell-ID","missing_transaction":"Transaktion der Bestellung nicht gefunden","general_request_error":"Leider ist ein Fehler bei der Bearbeitung Ihrer Anfrage aufgetreten. Bitte versuchen Sie es erneut.","in3LogoLabel":"Zahlungslogo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}}'),g=JSON.parse('{"buckaroo-payment":{"fee":"Buckaroo Fee","order":{"refundDescription":"Refund for order #orderNumber"},"general":{"title":"Buckaroo","description":"Buckaroo Payment"},"settingsForm":{"save":"Save","titleSuccess":"Success","titleError":"Error"},"supportModal":{"menuButton":"Version & Support","title":"Version & Support","support":{"description":"Before contacting Buckaroo technical support, please retrieve your (Merchant) key, Secret key, certificate and certificate thumbprint.","label1":"Buckaroo Payment Plaza:","label2":"Phone:","label3":"E-mail:","label4":"Website:","your_version":"Your PHP version:","version":"Version compatibility","information":"Information"}},"tabs":{"title":"Buckaroo Payment","overview":"Overview"},"paymentDetail":{"yourLink":"Your Paylink","paylinkButton":"Create paylink","paylinkDescription":"Create paylink for order","paylinkTitle":"Paylink","refundTitle":"Refund","transactionsTitle":"Transactions","amountTitle":"Amount","amountTotalTitle":"Grand total","amountRefundTotalTitle":"Refund Grand total","amountCustomRefundTitle":"Refund custom amount","buttonTitle":"Refund","successTitle":"Success","successMessage":"Buckaroo success refunded ","errorTitle":"Error","payTitle":"Capture payment","payDescription":"Capture and create invoice for order","payButton":"Capture payment"},"orderItems":{"title":"Items to Refund","types":{"id":"id","name":"Title","quantity":"Qty to Refund","totalAmount":"Subtotal"}},"transactionsToRefund":{"title":"Refund Totals"},"transactionHistory":{"types":{"id":"id","created_at":"Date/time","total":"Total","shipping_costs":"Shipping costs","total_excluding_vat":"Total excluding VAT","total_including_vat":"Total including VAT","vat":"VAT","transaction_key":"Transaction key","transaction_method":"Payment method","statuscode":"Status"}},"messageNotValid":"This field not valid.","messageNotBlank":"This field must not be empty.","button":{"labelTestApi":"Test connection"},"afterpay":{"setup":"Setup tax association for Riverty old ","hightTaxes":"High VAT taxes","middleTaxes":"Middle VAT taxes","lowTaxes":"Low VAT taxes","zeroTaxes":"Zero VAT","noTaxes":"No VAT tax"},"paymentInTestMode":"The payment for this order was made in test mode","refund":{"not_supported":"Refund is not supported","already_refunded":"This order is already refunded","refunded_amount":"Buckaroo success refunded"},"test_api":{"connection_ready":"Connection ready","connection_failed":"Connection failed"},"paylink":{"invalid_amount":"Amount is not valid","pay_link":"Your Paylink:"},"missing_order_id":"Missing order orderId","missing_transaction":"Order transaction not found","general_request_error":"Unfortunately an error occurred while processing your request. Please try again.","in3LogoLabel":"Payment Logo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}}');let{Module:h}=Shopware;h.register("buckaroo-payment",{type:"plugin",name:"BuckarooPayment",title:"buckaroo-payment.general.title",description:"buckaroo-payment.general.description",version:"1.0.0",targetVersion:"1.0.0",color:"#000000",icon:"default-action-settings",snippets:{"nl-NL":p,"de-DE":m,"en-GB":g},routeMiddleware(e,t){"sw.order.detail"===t.name&&t.children.push({component:"buckaroo-payment-detail",name:"buckaroo.payment.detail",isChildren:!0,path:"/sw/order/buckaroo/detail/:id"}),e(t)},routes:{config:{component:"buckaroo-payment-config",path:":namespace/payment/:paymentCode",name:"buckaroo.config.payment",meta:{parentPath:"sw.extension.config"},props:{default(e){return{namespace:e.params.namespace}}}}}}),n(442),n(964);let{Component:f}=Shopware;f.register("buckaroo-afterpay-old-tax",{template:'<div>\r\n    <a style="margin-bottom:10px;" @click="showTaxes = !showTaxes">{{$tc(\'buckaroo-payment.afterpay.setup\')}}</a>\r\n    <div v-if="showTaxes" style="padding: 10px;background: rgb(246 246 246); margin-bottom:10px;">\r\n        <div class="tax" v-for="tax in taxes">\r\n            <sw-select-field\r\n            :label="tax.name"\r\n            label-property="name"\r\n            value-property="id"\r\n            :options="afterpayTaxes"\r\n            @change="(value) => setTaxAssociation(tax.id, value)"\r\n            @input="(value) => setTaxAssociation(tax.id, value)"\r\n            @update:value="(value) => setTaxAssociation(tax.id, value)"\r\n            :value="getSelectValue(tax.id)"\r\n            ></sw-select-field>\r\n        </div>\r\n    </div>\r\n</div>',inject:["BuckarooPaymentSettingsService"],data(){return{taxes:[],showTaxes:!1,afterpayTaxes:[{name:this.$tc("buckaroo-payment.afterpay.hightTaxes"),id:1},{name:this.$tc("buckaroo-payment.afterpay.middleTaxes"),id:5},{name:this.$tc("buckaroo-payment.afterpay.lowTaxes"),id:2},{name:this.$tc("buckaroo-payment.afterpay.zeroTaxes"),id:3},{name:this.$tc("buckaroo-payment.afterpay.noTaxes"),id:4}],taxAssociation:{}}},model:{prop:"value",event:"change"},computed:{},props:{name:{type:String,required:!0,default:""},value:{type:Object,required:!1,default(){return{}}}},created(){this.BuckarooPaymentSettingsService.getTaxes().then(e=>{this.taxes=e.taxes.map(e=>({id:e.id,name:e.name}))})},methods:{setTaxAssociation(e,t){try{let n=t;t&&"object"==typeof t&&(t.target?n=t.target.value:t.hasOwnProperty("value")?n=t.value:t.hasOwnProperty("id")&&(n=t.id)),this.taxAssociation[e]=n,this.$emit("change",{...this.value,...this.taxAssociation})}catch(e){console.error("Error in setTaxAssociation:",e)}},getSelectValue(e){if(this.value[e])return this.value[e]}}});let{Component:y}=Shopware;y.register("buckaroo-main-config",{template:'<div>\r\n    <buckaroo-config-card\r\n            :card="mainCard"\r\n            :configSettings="configSettings"\r\n            :methods="elementMethods"\r\n            :isNotDefaultSalesChannel="isNotDefaultSalesChannel"\r\n            :value="value"\r\n            :currentSalesChannelId="currentSalesChannelId"\r\n            @input="onInput"\r\n            v-if="mainCard && value">\r\n    </buckaroo-config-card>\r\n\r\n    <buckaroo-payment-list\r\n        v-if="selectedCard === \'general\'"\r\n        :configSettings="configSettings"\r\n        :currentSalesChannelId="currentSalesChannelId"\r\n        :value="value"\r\n        @input="onInput">\r\n    </buckaroo-payment-list>\r\n</div>',props:{configSettings:{type:Array,required:!1,default:()=>[]},value:{type:Object,required:!1,default:()=>({})},elementMethods:{type:Object,required:!1,default:()=>({})},isNotDefaultSalesChannel:{type:Boolean,required:!1,default:!1},currentSalesChannelId:{type:String,required:!1,default:null}},emits:["input"],model:{prop:"value",event:"input"},data(){return{selectedCard:this.$route.params?.paymentCode||"general"}},watch:{value:{handler(e,t){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0,immediate:!0},$route(e){e.params?.paymentCode&&(this.selectedCard=e.params.paymentCode)}},computed:{mainCard(){return this.configSettings.filter(e=>e.name===this.selectedCard)?.pop()}},methods:{onInput(e){this.$emit("input",e)}}});let{Component:b}=Shopware;b.register("buckaroo-config-card",{template:'{% block buckaroo_config_card %}\r\n    <sw-card position-identifier="xxsw-system-config-content" v-if="card">\r\n        <template #title>\r\n            {{ getInlineSnippet(card.title) || \'Configuration\' }}\r\n        </template>\r\n\r\n        <div v-for="element in (card.elements || [])" :key="element.name">\r\n            <div v-if="canShow(element)">\r\n                <slot name="card-element" v-bind="{ element: getElementBind(element), config: value, card }">\r\n                    <sw-inherit-wrapper\r\n                            :value="getValueForName(element.name.replace(\'BuckarooPayments.config.\', \'\'))"\r\n                            v-bind="getInheritWrapperBind(element)"\r\n                            :has-parent="isNotDefaultSalesChannel"\r\n                            :inherited-value="getInheritedValue(element)"\r\n                            :class="\'sw-system-config--field-\' + kebabCase(getElementBind(element).name)"\r\n                            @input="onFieldInput(element.name, $event)"\r\n                    >\r\n                        <template #content="props">\r\n                            {# Special handling for fields that must be true multi-selects #}\r\n                            <template v-if="[\'allowedcreditcard\', \'allowedcreditcards\', \'allowedgiftcards\', \'giftcardsPaymentmethods\', \'payperemailAllowed\'].includes(element.name.replace(\'BuckarooPayments.config.\', \'\'))">\r\n                                <sw-multi-select\r\n                                    v-bind="getElementBind(element, props)"\r\n                                    :key="`${element.name}-multi-${props.isInheritField}-${props.isInherited}`"\r\n                                    :disabled="props.isInherited"\r\n                                    :value="Array.isArray(props.currentValue) ? props.currentValue : (props.currentValue ? [props.currentValue] : [])"\r\n                                    :options="\r\n                                        (getElementBind(element, props).config && getElementBind(element, props).config.options\r\n                                            ? getElementBind(element, props).config.options\r\n                                            : []\r\n                                        ).map(opt => ({\r\n                                            value: opt.id,\r\n                                            label: opt.name && typeof opt.name === \'object\'\r\n                                                ? (opt.name[$i18n.locale] || opt.name[\'en-GB\'] || Object.values(opt.name)[0] || opt.id)\r\n                                                : (opt.name || opt.id)\r\n                                        }))\r\n                                    "\r\n                                    labelProperty="label"\r\n                                    valueProperty="value"\r\n                                    :error="getFieldError(element.name)"\r\n                                    @change="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\r\n                                    @update:value="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\r\n                                />\r\n                            </template>\r\n                            <template v-else>\r\n                                <sw-form-field-renderer\r\n                                        v-bind="getElementBind(element, props)"\r\n                                        :key="element.type === \'bool\' ? `${element.name}-${props.isInheritField}-${props.isInherited}-${props.currentValue}` : `${element.name}-${props.isInheritField}-${props.isInherited}`"\r\n                                        :disabled="props.isInherited"\r\n                                        :value="element.type === \'bool\' ? Boolean(props.currentValue) : props.currentValue"\r\n                                        :error="getFieldError(element.name)"\r\n                                        @input="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\r\n                                        @change="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\r\n                                        @update:value="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }"\r\n                                />\r\n                            </template>\r\n                        </template>\r\n                    </sw-inherit-wrapper>\r\n                </slot>\r\n            </div>\r\n        </div>\r\n\r\n        <buckaroo-test-credentials\r\n                v-if="canShowCredentialTester"\r\n                :config="value"\r\n                :currentSalesChannelId="currentSalesChannelId"\r\n        />\r\n    </sw-card>\r\n{% endblock %}\r\n',inject:["BuckarooPaymentSettingsService"],data(){return{shopwareVersion:null}},mounted(){this.fetchShopwareVersion(),this.$nextTick(()=>{this.$forceUpdate()})},watch:{value:{handler(){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0,immediate:!0},currentSalesChannelId:{handler(e,t){e!==t&&this.$nextTick(()=>{this.$forceUpdate()})},immediate:!1}},computed:{canShowCredentialTester(){let e=this.getValueForName("websiteKey"),t=this.getValueForName("secretKey");return this.card?.name==="general"&&(null!=e&&""!==e||null!=t&&""!==t)},hasValidConfigData(){return this.value&&"object"==typeof this.value&&Object.keys(this.value).length>0},reactiveValue(){return this.value}},emits:["input"],model:{prop:"value",event:"input"},props:{card:{type:Object,required:!1,default:()=>({elements:[]})},configSettings:{type:Array,required:!1,default:()=>[]},methods:{type:Object,required:!0},isNotDefaultSalesChannel:{type:Boolean,required:!0},currentSalesChannelId:{type:String,required:!0},value:{type:Object,required:!1,default:()=>({})}},methods:{fetchShopwareVersion(){let e=this.BuckarooPaymentSettingsService;e&&"function"==typeof e.getSupportVersion&&e.getSupportVersion().then(e=>{e&&e.shopware_version&&(this.shopwareVersion=e.shopware_version)}).catch(()=>{})},isShopware674OrNewer(){if(!this.shopwareVersion||"string"!=typeof this.shopwareVersion)return!1;let e=this.shopwareVersion.split(".").map(e=>parseInt(e,10)||0),t=e[0]||0,n=e[1]||0,a=e[2]||0,r=e[3]||0;return t>6||!(t<6)&&(n>7||!(n<7)&&(a>4||!(a<4)&&r>=0))},getElementBind(e,t={}){if(!this.methods||!this.methods.getElementBind){let t=e.label?this.getInlineSnippet(e.label):null;return{name:e.name,type:e.type||"text",config:e.config||{},label:t,value:this.getValueForName(e.name.replace("BuckarooPayments.config.",""))}}let n=this.methods.getElementBind(e,t),a=e.name.replace("BuckarooPayments.config.",""),r=this.getValueForName(a),i=n.config||e.config||{};"bool"===e.type&&(r=null==r?void 0!==n.value&&n.value:"string"==typeof r?"1"===r||"true"===r||"on"===r:!!r);let o=null,s=this.isShopware674OrNewer();if(s){if(("bool"===e.type||"single-select"===e.type||"multi-select"===e.type)&&this.configSettings&&Array.isArray(this.configSettings)){for(let t of this.configSettings)if(t.elements&&Array.isArray(t.elements)){let n=t.elements.find(t=>t.name===e.name);if(n){if(n.label){let e=this.getInlineSnippet(n.label);if(!e||"string"==typeof e&&0===e.trim().length){if("object"==typeof n.label&&null!==n.label){let t=this.$i18n?.locale||"en-GB";e=n.label[t]||n.label["en-GB"]||Object.values(n.label)[0]||null}else"string"==typeof n.label&&(e=n.label)}if(e&&"string"==typeof e&&e.trim().length>0){o=e;break}}if(!o&&n.config&&n.config.label){let e=this.getInlineSnippet(n.config.label);if(!e||"string"==typeof e&&0===e.trim().length){if("object"==typeof n.config.label&&null!==n.config.label){let t=this.$i18n?.locale||"en-GB";e=n.config.label[t]||n.config.label["en-GB"]||Object.values(n.config.label)[0]||null}else"string"==typeof n.config.label&&(e=n.config.label)}if(e&&"string"==typeof e&&e.trim().length>0){o=e;break}}}}}if(!o){if(n.label&&"string"==typeof n.label&&n.label.trim().length>0)o=n.label;else if(e.label){let t=this.getInlineSnippet(e.label);if(!t||"string"==typeof t&&0===t.trim().length){if("object"==typeof e.label&&null!==e.label){let n=this.$i18n?.locale||"en-GB";t=e.label[n]||e.label["en-GB"]||Object.values(e.label)[0]||null}else"string"==typeof e.label&&(t=e.label)}t&&"string"==typeof t&&t.trim().length>0&&(o=t)}else if(this.card&&this.card.elements&&Array.isArray(this.card.elements)){let t=this.card.elements.find(t=>t.name===e.name);if(t&&t.label){let e=this.getInlineSnippet(t.label);if(!e||"string"==typeof e&&0===e.trim().length){if("object"==typeof t.label&&null!==t.label){let n=this.$i18n?.locale||"en-GB";e=t.label[n]||t.label["en-GB"]||Object.values(t.label)[0]||null}else"string"==typeof t.label&&(e=t.label)}e&&"string"==typeof e&&e.trim().length>0&&(o=e)}}}!o&&n.config&&n.config.label&&"string"==typeof n.config.label&&n.config.label.trim().length>0&&(o=n.config.label)}let l=i;s&&o&&"string"==typeof o&&o.trim().length>0&&("bool"===e.type||"single-select"===e.type||"multi-select"===e.type)&&(l={...i,label:o});let c={...n,config:l};if(["allowedcreditcard","allowedcreditcards","allowedgiftcards","giftcardsPaymentmethods","payperemailAllowed"].includes(a)){c.type="multi-select",c.componentName="sw-multi-select",c.config={...c.config||{},multiple:!0,options:c.config&&c.config.options||i&&i.options||e.options||[]};let t=Array.isArray(c.config?.options)&&c.config.options.length>0?c.config.options[0]:null;console.debug("[BuckarooConfigCard] getElementBind multi-select binding",{fieldName:a,bindingType:c.type,componentName:c.componentName,optionsCount:Array.isArray(c.config?.options)?c.config.options.length:0,currentValue:r,sampleOption:t})}return s&&o&&"string"==typeof o&&o.trim().length>0&&("bool"===e.type?c.label=o:c.label&&("string"!=typeof c.label||0!==c.label.trim().length)||(c.label=o)),"bool"===e.type&&(c.value=r,s&&(!c.label||"string"==typeof c.label&&0===c.label.trim().length)&&(c.label=c.config?.label||e.name.replace("BuckarooPayments.config.","").replace(/([A-Z])/g," $1").trim())),"bool"!==e.type&&"single-select"!==e.type&&"multi-select"!==e.type||c.label&&("string"!=typeof c.label||0!==c.label.trim().length)||console.warn("Missing label for field:",e.name,"Type:",e.type,"Element label:",e.label,"Extracted:",o,"BaseBinding label:",n.label,"Final binding label:",c.label),c},getInheritWrapperBind(e){if(!this.methods||!this.methods.getInheritWrapperBind){let t=e.name.replace("BuckarooPayments.config.","");return{name:e.name,currentValue:this.getValueForName(t)}}let t=this.methods.getInheritWrapperBind(e),n=e.name.replace("BuckarooPayments.config.",""),a=this.getValueForName(n);return t.currentValue=a,t},getFieldError(e){return this.methods&&this.methods.getFieldError?this.methods.getFieldError(e):null},kebabCase(e){return this.methods&&this.methods.kebabCase?this.methods.kebabCase(e):e?e.toLowerCase().replace(/[A-Z]/g,"-$&").replace(/^-/,""):""},getInlineSnippet(e){try{if("object"==typeof e&&null!==e){let t=this.$i18n?.locale||"en-GB";if(e[t])return e[t];if(e["en-GB"])return e["en-GB"];let n=Object.keys(e)[0];if(n&&e[n])return e[n];return JSON.stringify(e)}if("string"==typeof e){if(this.$t&&"function"==typeof this.$t)return this.$t(e);return e}return String(e)}catch(t){return console.warn("Translation error for:",e,t),"object"==typeof e?JSON.stringify(e):String(e)}},getInheritedValue(e){return this.methods&&this.methods.getInheritedValue?this.methods.getInheritedValue(e):null},getValueForName(e){let t;let n=this.reactiveValue;if(!n||"object"!=typeof n)return null;let a=[`BuckarooPayments.config.${e}`,e.toLowerCase(),e.charAt(0).toLowerCase()+e.slice(1),e.charAt(0).toUpperCase()+e.slice(1)];for(let e of a)if(void 0!==n[e]){t=n[e];break}if(void 0===t&&n["BuckarooPayments.config"]&&"object"==typeof n["BuckarooPayments.config"]){for(let e of a)if(void 0!==n["BuckarooPayments.config"][e]){t=n["BuckarooPayments.config"][e];break}}return t&&"object"==typeof t&&t.hasOwnProperty("_value")&&(t=t._value),t},canShow(e){if(!e||!e.name)return!1;let t=e.name.replace("BuckarooPayments.config.","");return["orderStatus","paymentSuccesStatus","automaticallyCloseOpenOrders","sendInvoiceEmail"].includes(t)?!!this.getValueForName("advancedConfiguration"):"idealprocessingRenderMode"===t?!!this.getValueForName("idealprocessingShowissuers"):"idealRenderMode"===t?!!this.getValueForName("idealShowissuers"):["idealFastCheckoutEnabled","idealFastCheckoutVisibility","idealFastCheckoutLogoScheme"].includes(t)?!!this.getValueForName("idealFastCheckout"):"afterpayPaymentstatus"===t?!!this.getValueForName("afterpayCaptureonshippent"):"afterpayOldtax"!==t||!!this.getValueForName("afterpayEnabledold")},onInput(e){this.$emit("input",e)},onFieldInput(e,t){try{let n=t;if(t&&"object"==typeof t){if(t.target){let e=t.target;n="checkbox"===e.type||"radio"===e.type?e.checked:("SELECT"===e.tagName||"select-one"===e.type||"select-multiple"===e.type)&&e.multiple?Array.from(e.selectedOptions).map(e=>e.value):e.value}else if(t.hasOwnProperty("value"))n=t.value;else if(t.hasOwnProperty("id")&&t.hasOwnProperty("name"))n=t.id;else if(Array.isArray(t)){let e=t.filter(e=>"string"==typeof e&&1===e.length).length,a=t.some(e=>","===e);if(t.some(e=>"string"==typeof e&&e.length>1),e>10&&a){let e=t.filter(e=>"string"==typeof e&&e.length>1),a=t.filter(e=>"string"==typeof e&&1===e.length).join(""),r=[];a.includes(",")?r=a.split(",").map(e=>e.trim()).filter(e=>e.length>0):a.length>0&&(r=[a]),n=[...r,...e].filter(e=>e&&e.length>0)}else n=t.filter(e=>!(null==e||""===e||"string"==typeof e&&1===e.length||"string"==typeof e&&(e.startsWith("+")||/^\d+$/.test(e)))).map(e=>"object"==typeof e&&null!==e&&(e.id||e.value||e.code||e.key)||e)}else for(let e of["id","value","key","code"])if(void 0!==t[e]){n=t[e];break}}else"boolean"==typeof t?n=t:("string"==typeof t||"number"==typeof t)&&(n=t);let a=this.card?.elements?.find(t=>t.name===e||t.name.replace("BuckarooPayments.config.","")===e.replace("BuckarooPayments.config.",""));"on"===n?n=!0:"off"===n&&(n=!1),a&&"bool"===a.type&&(n="string"==typeof n?"1"===n||"true"===n||"on"===n:!!n),a&&"multi-select"===a.type&&(console.debug("[BuckarooConfigCard] onFieldInput before normalize (multi-select)",{fieldName:e,rawEvent:t,rawValue:n}),n=Array.isArray(n)?n.filter(e=>null!=e&&""!==e).map(e=>"object"==typeof e&&null!==e&&(e.id||e.value||e.code||e.key)||e):"string"==typeof n?n.split(",").map(e=>e.trim()).filter(e=>e.length>0):null==n?[]:[n],console.debug("[BuckarooConfigCard] onFieldInput after normalize (multi-select)",{fieldName:e,normalizedValue:n}));let r=e.replace("BuckarooPayments.config.",""),i={...this.value};i[r]=n,i[e]=n,this.$emit("input",i)}catch(e){console.error("Error in onFieldInput:",e),console.error("Error details:",e.stack)}}}}),n(345);let{Component:k,Filter:v}=Shopware;k.register("buckaroo-payment-list",{template:'<sw-card\r\n    position-identifier="bk-config-payment-list"\r\n    :title="$tc(\'buckaroo-payment.payment-methods\')"\r\n>\r\n<div class="bk-payment-wrap">\r\n <template\r\n    v-for="payment in payments" >\r\n    <div class="bk-payment">\r\n        <div class="bk-payment-inner">\r\n        <router-link  :title="$tc(\'buckaroo-payment.configure-payment\')" :to="{name: \'buckaroo.payment.config\', params: {namespace: \'BuckarooPayments\', paymentCode: payment.code } }">\r\n            <div class="bk-payment-img">\r\n                <img :src="assetFilter(`buckaroopayments/images/${payment.logo}`)" alt="Payment logo">\r\n            </div>\r\n            <div class="bk-payment-name">\r\n                {{ getPaymentTitle(payment.code) }}\r\n            </div>\r\n        </router-link>\r\n\r\n        <buckaroo-toggle-status\r\n            :currentSalesChannelId="currentSalesChannelId"\r\n            :method="payment.code"\r\n            :value="value"\r\n            @input="$emit(\'input\', $event)"\r\n        />\r\n\r\n        <router-link class="bk-link" :title="$tc(\'buckaroo-payment.configure-payment\')" :to="{name: \'buckaroo.payment.config\', params: {namespace: \'BuckarooPayments\', paymentCode: payment.code } }">\r\n            {{$tc(\'buckaroo-payment.configure-link\')}}\r\n        </router-link>\r\n        </div>\r\n    </div>\r\n </template>\r\n </div>\r\n</sw-card>',props:{configSettings:{type:Array,required:!1,default:()=>[]},value:{type:Object,required:!1,default:()=>({})},currentSalesChannelId:{type:String,required:!0}},emits:["input"],data(){return{payments:[{code:"Alipay",logo:"alipay.svg"},{code:"applepay",logo:"applepay.svg"},{code:"bancontactmrcash",logo:"bancontact.svg"},{code:"blik",logo:"blik.svg"},{code:"belfius",logo:"belfius.svg"},{code:"Billink",logo:"billink.svg"},{code:"creditcard",logo:"creditcards.svg"},{code:"creditcards",logo:"creditcards.svg"},{code:"eps",logo:"eps.svg"},{code:"giftcards",logo:"giftcards.svg"},{code:"idealqr",logo:"ideal-qr.svg"},{code:"ideal",logo:"ideal-wero.svg"},{code:"capayable",logo:"in3.svg"},{code:"KBCPaymentButton",logo:"kbc.svg"},{code:"klarnakp",logo:"klarna.svg"},{code:"knaken",logo:"gosettle.svg"},{code:"mbway",logo:"mbway.svg"},{code:"multibanco",logo:"multibanco.svg"},{code:"paybybank",logo:"paybybank.svg"},{code:"payconiq",logo:"payconiq.svg"},{code:"paypal",logo:"paypal.svg"},{code:"payperemail",logo:"payperemail.svg"},{code:"Przelewy24",logo:"przelewy24.svg"},{code:"afterpay",logo:"afterpay.svg"},{code:"sepadirectdebit",logo:"sepa-directdebit.svg"},{code:"transfer",logo:"sepa-credittransfer.svg"},{code:"Trustly",logo:"trustly.svg"},{code:"WeChatPay",logo:"wechatpay.svg"},{code:"swish",logo:"swish.svg"},{code:"bizum",logo:"bizum.svg"},{code:"twint",logo:"twint.svg"},{code:"wero",logo:"wero.svg"}]}},methods:{getPaymentTitle(e){if(this.configSettings&&Array.isArray(this.configSettings)){let t=this.configSettings.find(t=>t.name===e);if(t&&t.title)try{if("object"==typeof t.title&&null!==t.title){let e=this.$i18n?.locale||"en-GB";if(t.title[e])return t.title[e];if(t.title["en-GB"])return t.title["en-GB"];let n=Object.keys(t.title)[0];if(n&&t.title[n])return t.title[n];return JSON.stringify(t.title)}if("string"==typeof t.title){if(this.$t&&"function"==typeof this.$t)return this.$t(t.title);return t.title}return String(t.title)}catch(e){return console.warn("Translation error for:",t.title,e),"object"==typeof t.title?JSON.stringify(t.title):String(t.title)}}let t=this.payments.find(t=>t.code===e);return t?t.code:"Unknown Payment"},assetFilter(e){return v.getByName("asset")(e)}}});let{Component:w}=Shopware;w.register("buckaroo-test-credentials",{template:'    <sw-button @click="sendTestApi" :disabled="!enabled" variant="primary" :square="false" :block="true" :isLoading="isLoading">{{ $tc(\'buckaroo-payment.button.labelTestApi\') }}</sw-button>',mixins:[Shopware.Mixin.getByName("notification")],data(){return{isLoading:!1}},inject:["BuckarooPaymentSettingsService"],props:{config:{type:Object,required:!0},currentSalesChannelId:{required:!0}},computed:{enabled:function(){return(this.getConfigValue("websiteKey")||"").length>0&&(this.getConfigValue("secretKey")||"").length>0}},methods:{getConfigValue:function(e){return this.config["BuckarooPayments.config."+e]},sendTestApi(){this.isLoading=!0;let e=this.getConfigValue("websiteKey"),t=this.getConfigValue("secretKey");this.BuckarooPaymentSettingsService.getApiTest(e,t,this.currentSalesChannelId).then(e=>{this.isLoading=!1,"success"==e.status?this.createNotificationSuccess({title:this.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:this.$tc(e.message)}):this.createNotificationError({title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:this.$tc(e.message)})}).catch(()=>{this.isLoading=!1})}}}),n(177);let{Component:_}=Shopware;_.register("buckaroo-toggle-status",{template:'<div class="bk-toogle-wrap">\r\n    <button\r\n            type="button"\r\n            :disabled="isLoading"\r\n            :class="`live ${getClass(\'live\')}`"\r\n            @click="setStatus(\'live\')"\r\n    >\r\n        Live\r\n    </button>\r\n\r\n    <button\r\n            v-if="method !== \'idealqr\'"\r\n            type="button"\r\n            :disabled="isLoading"\r\n            :class="`test ${getClass(\'test\')}`"\r\n            @click="setStatus(\'test\')"\r\n    >\r\n        Test\r\n    </button>\r\n\r\n    <button\r\n            type="button"\r\n            :disabled="isLoading"\r\n            :class="`disabled ${getClass(\'disabled\')}`"\r\n            @click="setStatus(\'disabled\')"\r\n    >\r\n        Off\r\n    </button>\r\n</div>\r\n',props:{method:{type:String,required:!0},value:{required:!0},currentSalesChannelId:{required:!0}},emits:["input"],inject:["systemConfigApiService"],data(){return{status:"disabled",isLoading:!1}},mounted(){this.status=this.getStatus()},watch:{value:{handler(e){this.status=this.getStatus()},deep:!0,immediate:!0}},methods:{getStatus(){let e=this.isActive(),t=this.getEnvironment();return e?t:"disabled"},isActive(){let e=this.getValueForName(`${this.method}Enabled`);return"string"==typeof e?"true"===e.toLowerCase():!!e},getEnvironment(){let e=this.getValueForName(`${this.method}Environment`);return null==e||""===e?"test":["test","live"].includes(e)?e:"test"},getValueForName(e){let t;let n=`BuckarooPayments.config.${e}`;if(!this.value||"object"!=typeof this.value)return null;if(void 0!==this.value[n])t=this.value[n];else if(void 0!==this.value[e])t=this.value[e];else if(this.value["BuckarooPayments.config"]&&"object"==typeof this.value["BuckarooPayments.config"])void 0!==this.value["BuckarooPayments.config"][e]&&(t=this.value["BuckarooPayments.config"][e]);else for(let n of[e,e.toLowerCase(),e.charAt(0).toLowerCase()+e.slice(1),e.charAt(0).toUpperCase()+e.slice(1)]){let e=`BuckarooPayments.config.${n}`;if(void 0!==this.value[e]){t=this.value[e];break}if(void 0!==this.value[n]){t=this.value[n];break}}return t&&"object"==typeof t&&t.hasOwnProperty("_value")&&(t=t._value),t},setStatus(e){this.status=e,this.saveStatus()},getClass(e){return this.status===e?"active":""},async saveStatus(){let e=`BuckarooPayments.config.${this.method}Enabled`,t=`BuckarooPayments.config.${this.method}Environment`,n={[e]:!1},a={...this.value};a[e]=!1,-1!==["live","test"].indexOf(this.status)&&(n={[e]:!0,[t]:this.status},a[e]=!0,a[t]=this.status),this.$emit("input",a),this.isLoading=!0;try{await this.systemConfigApiService.batchSave({[this.currentSalesChannelId]:n}).finally(()=>{this.isLoading=!1}),this.renderSuccess()}catch(e){this.renderError(e)}},renderSuccess(){this.$store.dispatch("notification/createNotification",{variant:"success",message:this.$tc("sw-extension-store.component.sw-extension-config.messageSaveSuccess")})},renderError(e){this.$store.dispatch("notification/createNotification",{variant:"error",message:e})}}})}()}();