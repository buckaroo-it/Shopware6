const B=`{% block sw_order_detail_content_tabs %} <div v-if="isPaymentInTestMode && setIsBuckarooPayment" style="max-width: 960px; margin: 0 auto 15px; background: rgb(251, 227, 231); border-radius:4px; color: #de294c; display:flex; align-items:center;"> <div style="background:#de294c;padding: 4px 8px;border-radius: 4px 0 0 4px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="m13.7744 1.4124 9.7058 18.6649c.5096.98.1283 2.1875-.8517 2.6971a2 2 0 0 1-.9227.2256H2.2942c-1.1045 0-2-.8954-2-2a2 2 0 0 1 .2256-.9227l9.7058-18.665c.5096-.98 1.7171-1.3613 2.6971-.8517a2 2 0 0 1 .8517.8518zM2.2942 21h19.4116L12 2.335 2.2942 21zM12 17c.5523 0 1 .4477 1 1s-.4477 1-1 1-1-.4477-1-1 .4477-1 1-1zm1-2c0 .5523-.4477 1-1 1s-1-.4477-1-1v-5c0-.5523.4477-1 1-1s1 .4477 1 1v5z" id="icons-default-warning"></path></defs><use xlink:href="#icons-default-warning" fill="#fff" fill-rule="evenodd"></use></svg></div> <p style="margin-left:10px;">{{ $tc('buckaroo-payment.paymentInTestMode') }}</p> </div> {% parent %} {% endblock %} {% block sw_order_detail_content_tabs_general %} {% parent %} <sw-tabs-item v-if="setIsBuckarooPayment" :route="{ name: 'buckaroo.payment.detail', params: { id: $route.params.id } }" :title="$tc('buckaroo-payment.tabs.title')"> {{ $tc('buckaroo-payment.tabs.title') }} </sw-tabs-item> {% endblock %} {% block sw_order_detail_actions %} <template v-if="isEditable"> </template> {% parent %} {% endblock %}`,{Component:T,Context:_}=Shopware,$=Shopware.Data.Criteria;T.override("sw-order-detail",{template:B,data(){return{isBuckarooPayment:!1,isPaymentInTestMode:!1}},computed:{isEditable(){return!this.isBuckarooPayment||this.$route.name!=="buckaroo.payment.detail"},showTabs(){return!0}},watch:{orderId:{deep:!0,handler(){if(!this.orderId){this.setIsBuckarooPayment(null);return}const e=this.repositoryFactory.create("order"),t=new $(1,1);t.addAssociation("transactions"),e.get(this.orderId,_.api,t).then(a=>{if(this.setPaymentInTestMode(a),a.transactions.length<=0||!a.transactions.last().paymentMethodId){this.setIsBuckarooPayment(null);return}const o=a.transactions.last().paymentMethodId;o!=null&&this.setIsBuckarooPayment(o)})},immediate:!0}},methods:{setPaymentInTestMode(e){e.customFields&&e.customFields.buckaroo_payment_in_test_mode&&(this.isPaymentInTestMode=e.customFields.buckaroo_payment_in_test_mode===!0)},setIsBuckarooPayment(e){if(!e)return;this.repositoryFactory.create("payment_method").get(e,_.api).then(a=>{this.isBuckarooPayment=a.formattedHandlerIdentifier.indexOf("buckaroo")>=0})}}});const P=`{% block sw_order_detail_base_line_items_summary %} <sw-card-section divider="top" secondary slim v-if="order.customFields !== null"> <sw-container columns="1fr 440px" class="sw-order-detail__summary" v-if="order.customFields.buckarooFee !== null && order.customFields.buckarooFee > 0"> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"> <dt>{{ $tc('buckaroo-payment.fee') }}</dt> <dd>{{ order.customFields.buckarooFee }} {% if order.currency.isoCode == "PLN" %} PLN {% else %} {{ order.currency.symbol }} {% endif %} </dd> </sw-description-list> </sw-container> </sw-card-section> {% parent %} {% endblock %}`,{Component:I,Context:ne}=Shopware;Shopware.Data.Criteria;I.override("sw-order-detail-base",{template:P});const A=`{% block sw_order_detail_base_secondary_info_payment %} <template v-if="currentOrder.transactions.length > 0 && (!currentOrder.transactions.last().paymentMethod.translated.customFields || !currentOrder.transactions.last().paymentMethod.translated.customFields.is_buckaroo)"> {% parent %} </template> <template v-if="currentOrder.transactions.length > 0 && currentOrder.transactions.last().paymentMethod.translated.customFields && currentOrder.transactions.last().paymentMethod.translated.customFields.is_buckaroo"> <dt>{{ $tc('sw-order.detailBase.labelPaymentMethod') }}</dt> <dd> <template v-if="config['BuckarooPayments.config.' + currentOrder.transactions.last().paymentMethod.translated.customFields.buckaroo_key + 'Label']"> {{ config['BuckarooPayments.config.' + currentOrder.transactions.last().paymentMethod.translated.customFields.buckaroo_key + 'Label'] }} </template> </dd> </template> {% endblock %}`,{Component:x}=Shopware;x.override("sw-order-user-card",{template:A,inject:["systemConfigApiService"],data(){return{config:{}}},created(){this.systemConfigApiService.getValues("BuckarooPayments.config",null).then(e=>{this.config=e}).finally(()=>{})}});const F=`{% block sw_system_config_content_card %} <template v-if="domain !== 'BuckarooPayments.config'"> {% parent() %} </template> <template v-else> <buckaroo-main-config :value="actualConfigData[currentSalesChannelId]" :configSettings="config" :isNotDefaultSalesChannel="isNotDefaultSalesChannel" :currentSalesChannelId="currentSalesChannelId" :elementMethods="{getElementBind, getFieldError, getInheritWrapperBind, getInheritedValue, hasMapInheritanceSupport, getInlineSnippet, kebabCase}" @input="onConfigDataUpdate" v-if="!isLoading && actualConfigData[currentSalesChannelId] && config && config.length > 0" ></buckaroo-main-config> </template> {% endblock %}`,{Component:R}=Shopware;R.override("sw-system-config",{template:F,watch:{currentSalesChannelId:{handler(e,t){e&&this.domain==="BuckarooPayments.config"&&this.loadBuckarooConfigData()},immediate:!0},domain:{handler(e){e==="BuckarooPayments.config"&&this.currentSalesChannelId&&this.loadBuckarooConfigData()},immediate:!0}},methods:{loadBuckarooConfigData(){this.systemConfigApiService.getValues("BuckarooPayments.config",this.currentSalesChannelId).then(e=>{this.actualConfigData[this.currentSalesChannelId]||(this.actualConfigData[this.currentSalesChannelId]={});const t={};e&&typeof e=="object"&&Object.keys(e).forEach(a=>{const o=e[a];o&&typeof o=="object"&&o.hasOwnProperty("_value")?t[a]=o._value:t[a]=o;const n=a.replace("BuckarooPayments.config.","");n!==a&&(t[n]=t[a])}),this.actualConfigData[this.currentSalesChannelId]={},Object.keys(t).forEach(a=>{this.actualConfigData[this.currentSalesChannelId][a]=t[a]}),this.$nextTick(()=>{this.$forceUpdate()})}).catch(e=>{console.error("Error fetching system config:",e)})},onConfigDataUpdate(e){this.actualConfigData[this.currentSalesChannelId]||(this.actualConfigData[this.currentSalesChannelId]={}),Object.keys(e).forEach(t=>{if(this.actualConfigData[this.currentSalesChannelId][t]=e[t],!t.startsWith("BuckarooPayments.config.")){const a=`BuckarooPayments.config.${t}`;this.actualConfigData[this.currentSalesChannelId][a]=e[t]}})},saveAll(){return this.domain!=="BuckarooPayments.config"?this.$super("saveAll"):this.saveBuckaroo()},saveBuckaroo(){return this.isLoading=!0,this.systemConfigApiService.batchSave(this.getSelectedValues()).finally(()=>{this.isLoading=!1})},getCurrentConfigCard(){var t,a;const e=((t=this.$route.params)==null?void 0:t.paymentCode)||"general";return(a=this.config.filter(o=>o.name===e))==null?void 0:a.pop()},getSelectedValues(){const e=this.actualConfigData[this.currentSalesChannelId],t=this.getCurrentConfigCard();if(t!=null&&t.elements){let a={};return t==null||t.elements.forEach(o=>{if(o!=null&&o.name){let n=e[o.name];if(n===void 0){const s=o.name.replace("BuckarooPayments.config.","");n=e[s]}a[o.name]=n}}),{[this.currentSalesChannelId]:a}}return this.actualConfigData}}});const E=`{% block buckaroo_payment_detail %} <div class="buckaroo-payment-detail"> <sw-card positionIdentifier="bk-paylink" :title="$tc('buckaroo-payment.paymentDetail.paylinkTitle')" v-if="isPaylinkVisible"> {{ $tc('buckaroo-payment.paymentDetail.paylinkDescription') }} <span v-if="paylink"> <br> {{ $tc('buckaroo-payment.paymentDetail.yourLink') }}: <a :href="paylink">{{ paylink }}</a> </span> <sw-container columns="1fr 440px" class="sw-order-detail__summary"> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt> <dd> <sw-button @click="createPaylink(orderId)" :disabled="!isPaylinkAvailable"> {{ $tc('buckaroo-payment.paymentDetail.paylinkButton') }} </sw-button></dd> </sw-description-list> </sw-container> </sw-card> <sw-card positionIdentifier="bk-refund" :title="$tc('buckaroo-payment.paymentDetail.refundTitle')"> {{ $tc('buckaroo-payment.orderItems.title') }} <sw-data-grid :dataSource="orderItems" :columns="orderItemsColumns" :showActions="false" :showSelection="false"> <template #column-name="{ item }"> <sw-product-variant-info :showTooltip="false" :variations="item.variations"> {{ item.name }} </sw-product-variant-info> </template> <template #column-quantity="{ item }"> <input class="bk-reund-qty" type="number" min="0" :max="item.quantityMax" v-model="item.quantity" @input="recalculateOrderItems" onkeydown="return event.keyCode !== 69"> </template> </sw-data-grid> <sw-container columns="1fr 440px" class="sw-order-detail__summary"> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"> <dt>{{ $tc('buckaroo-payment.paymentDetail.amountTotalTitle') }}: </dt> <dd>{{ buckaroo_refund_amount }} {{ currency }}</dd> </sw-description-list> </sw-container> <sw-card-section divider="top" secondary slim> <sw-container columns="1fr 440px" class="sw-order-detail__summary"> </sw-container> <sw-data-grid :dataSource="transactionsToRefund" :columns="transactionsToRefundColumns" :showHeader="false" :showActions="false" :showSelection="false"> <template #column-transaction_method="{ item }"> <span v-if="item.transaction_method == 'KbcPaymentButton'"> Kbc </span> <span v-else> {{ item.transaction_method }} </span> </template> <template #column-amount="{ item }"> <input type="number" min="0" :max="item.amountMax" v-model="item.amount" @input="recalculateRefundItems" onkeydown="return event.keyCode !== 69"> </template> </sw-data-grid> <sw-container v-if="!isAuthorized" columns="1fr 440px" class="sw-order-detail__summary"> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"> <dt>{{ $tc('buckaroo-payment.paymentDetail.amountCustomRefundTitle') }}: </dt> <dd> <input id="buckaroo_custom_refund_enabled" type="checkbox" @click="toggleCustomRefund()"> <input id="buckaroo_custom_refund_amount" type="number" v-model="buckaroo_refund_total_amount" disabled style="width:70px;"> {{ currency }} </dd> </sw-description-list> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"> <dt>{{ $tc('buckaroo-payment.paymentDetail.amountRefundTotalTitle') }}: </dt> <dd>{{ buckaroo_refund_total_amount }} {{ currency }}</dd> </sw-description-list> </sw-container> </sw-card-section> <sw-container columns="1fr 440px" class="sw-order-detail__summary"> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt><dd> <sw-button @click="refundOrder(orderId, buckaroo_refund_amount)" :disabled="!isRefundPossible || isAuthorized"> {{ $tc('buckaroo-payment.paymentDetail.buttonTitle') }} </sw-button></dd> </sw-description-list> </sw-container> </sw-card> <sw-card positionIdentifier="bk-pay-desc" :title="$tc('buckaroo-payment.paymentDetail.payTitle')"> {{ $tc('buckaroo-payment.paymentDetail.payDescription') }} <sw-container columns="1fr 440px" class="sw-order-detail__summary"> <sw-description-list grid="265px 1fr" class="sw-order-detail__summary-data"><dt></dt><dd> <sw-button @click="captureOrder(orderId)" :disabled="!isCapturePossible"> {{ $tc('buckaroo-payment.paymentDetail.payButton') }} </sw-button></dd> </sw-description-list> </sw-container> </sw-card> <sw-card positionIdentifier="bk-pay-transaction" :title="$tc('buckaroo-payment.paymentDetail.transactionsTitle')"> <sw-data-grid :dataSource="relatedResources" :columns="relatedResourceColumns" :showActions="false" :showSelection="false"> <template #column-transaction_method="{ item }"> <span v-if="item.transaction_method == 'KbcPaymentButton'"> Kbc </span> <span v-else> {{ item.transaction_method }} </span> </template> </sw-data-grid> </sw-card> <sw-loader v-if="isLoading"> </sw-loader> </div> {% endblock %}`,{Component:D,Filter:oe,Context:V}=Shopware,S=Shopware.Data.Criteria;D.register("buckaroo-payment-detail",{template:E,inject:["repositoryFactory","BuckarooPaymentService","systemConfigApiService"],data(){return{config:{},buckaroo_refund_amount:"0",buckaroo_refund_total_amount:"0",currency:"EUR",isRefundPossible:!0,isCapturePossible:!1,isPaylinkAvailable:!1,isPaylinkVisible:!1,paylinkMessage:"",paylink:"",isLoading:!1,order:!1,buckarooTransactions:null,orderItems:[],transactionsToRefund:[],relatedResources:[],isAuthorized:!1}},computed:{orderItemsColumns(){return[{property:"name",label:this.$tc("buckaroo-payment.orderItems.types.name"),allowResize:!1,primary:!0,inlineEdit:!0,multiLine:!0},{property:"quantity",label:this.$tc("buckaroo-payment.orderItems.types.quantity"),rawData:!0,align:"right"},{property:"totalAmount",label:this.$tc("buckaroo-payment.orderItems.types.totalAmount"),rawData:!0,align:"right"}]},transactionsToRefundColumns(){return[{property:"transaction_method",rawData:!0},{property:"amount",rawData:!0}]},relatedResourceColumns(){return[{property:"created_at",label:this.$tc("buckaroo-payment.transactionHistory.types.created_at"),rawData:!0},{property:"total",label:this.$tc("buckaroo-payment.transactionHistory.types.total"),rawData:!0},{property:"shipping_costs",label:this.$tc("buckaroo-payment.transactionHistory.types.shipping_costs"),rawData:!0},{property:"total_excluding_vat",label:this.$tc("buckaroo-payment.transactionHistory.types.total_excluding_vat"),rawData:!0},{property:"vat",label:this.$tc("buckaroo-payment.transactionHistory.types.vat"),rawData:!0},{property:"transaction_key",label:this.$tc("buckaroo-payment.transactionHistory.types.transaction_key"),rawData:!0},{property:"transaction_method",label:this.$tc("buckaroo-payment.transactionHistory.types.transaction_method"),rawData:!0},{property:"statuscode",label:this.$tc("buckaroo-payment.transactionHistory.types.statuscode"),rawData:!0}]}},created(){this.createdComponent()},methods:{recalculateOrderItems(){this.buckaroo_refund_amount=0;for(const e in this.orderItems)this.orderItems[e].totalAmount=parseFloat(parseFloat(this.orderItems[e].unitPrice)*parseFloat(this.orderItems[e].quantity||0)).toFixed(2),this.buckaroo_refund_amount=parseFloat(parseFloat(this.buckaroo_refund_amount)+parseFloat(this.orderItems[e].totalAmount)).toFixed(2)},recalculateRefundItems(){this.buckaroo_refund_total_amount=0;for(const e in this.transactionsToRefund)this.transactionsToRefund[e].amount&&(this.buckaroo_refund_total_amount=parseFloat(parseFloat(this.buckaroo_refund_total_amount)+parseFloat(this.transactionsToRefund[e].amount)).toFixed(2))},getCustomRefundEnabledEl(){return document.getElementById("buckaroo_custom_refund_enabled")},getCustomRefundAmountEl(){return document.getElementById("buckaroo_custom_refund_amount")},toggleCustomRefund(){this.getCustomRefundEnabledEl()&&this.getCustomRefundAmountEl()&&(this.getCustomRefundAmountEl().disabled=!this.getCustomRefundEnabledEl().checked)},getCustomRefundAmount(){return this.getCustomRefundEnabledEl()&&this.getCustomRefundAmountEl()&&this.getCustomRefundEnabledEl().checked?this.getCustomRefundAmountEl().value:0},createdComponent(){let e=this;const t=this.$route.params.id;this.systemConfigApiService.getValues("BuckarooPayments.config",null).then(n=>{this.config=n});const a=this.repositoryFactory.create("order"),o=new S(1,1);this.orderId=t,o.addAssociation("transactions.paymentMethod").addAssociation("transactions"),o.getAssociation("transactions").addSorting(S.sort("createdAt")),a.get(t,V.api,o).then(n=>{e.checkedIsAuthorized(n),e.isCapturePossible=n.transactions&&n.transactions.last().paymentMethod&&n.transactions.last().paymentMethod.customFields&&n.transactions.last().paymentMethod.customFields.buckaroo_key&&["klarnakp","billink","afterpay"].includes(n.transactions.last().paymentMethod.customFields.buckaroo_key.toLowerCase())||e.isAfterpayCapturePossible(n),e.isPaylinkVisible=e.isPaylinkAvailable=this.getConfigValue("paylinkEnabled")&&n.stateMachineState&&n.stateMachineState.technicalName&&n.stateMachineState.technicalName=="open"&&n.transactions&&n.transactions.last().stateMachineState.technicalName=="open"}),this.BuckarooPaymentService.getBuckarooTransaction(t).then(n=>{e.orderItems=[],e.transactionsToRefund=[],e.relatedResources=[],this.$emit("loading-change",!1),n.orderItems&&Array.isArray(n.orderItems)&&n.orderItems.forEach(s=>{e.orderItems.push({id:s.id,name:s.name,quantity:s.quantity,quantityMax:s.quantity,unitPrice:s.unitPrice.value,totalAmount:s.totalAmount.value,variations:s.variations||[]})}),e.buckaroo_refund_amount=n.refundTotals?n.refundTotals.totalAmount:0,e.currency=n.refundTotals?n.refundTotals.currency:"EUR",n.transactionsToRefund&&Array.isArray(n.transactionsToRefund)&&n.transactionsToRefund.forEach(s=>{e.transactionsToRefund.push({id:s.id,transactions:s.transactions,amount:s.total,amountMax:s.total,currency:s.currency,transaction_method:s.transaction_method,logo:s.transaction_method?s.logo:null}),e.currency=s.currency}),e.recalculateRefundItems(),n.transactions&&Array.isArray(n.transactions)&&n.transactions.forEach(s=>{e.relatedResources.push({id:s.id,transaction_key:s.transaction,total:s.total,total_excluding_vat:s.total_excluding_vat,shipping_costs:s.shipping_costs,vat:s.vat,transaction_method:s.transaction_method,logo:s.transaction_method?s.logo:null,created_at:s.created_at,statuscode:s.statuscode})})}).catch(n=>{console.log("errorResponse",n)})},isAfterpayCapturePossible(e){return e.customFields.buckaroo_is_authorize===!0},checkedIsAuthorized(e){var t,a,o;this.isAuthorized=((o=(a=(t=e==null?void 0:e.transactions)==null?void 0:t.last())==null?void 0:a.stateMachineState)==null?void 0:o.technicalName)==="authorized"},refundOrder(e,t){let a=this;a.isRefundPossible=!1,this.BuckarooPaymentService.refundPayment(e,this.transactionsToRefund,this.orderItems,this.getCustomRefundAmount()).then(o=>{for(const n in o)o[n].status?this.$store.dispatch("notification/createNotification",{variant:"success",title:a.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:a.$tc(o[n].message)+o[n].amount}):this.$store.dispatch("notification/createNotification",{variant:"error",title:a.$tc("buckaroo-payment.settingsForm.titleError"),message:a.$tc(o[n].message)});a.isRefundPossible=!0,this.createdComponent()}).catch(o=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:o.response.data.message}),a.isRefundPossible=!0})},createPaylink(e){let t=this;t.isPaylinkAvailable=!1,this.BuckarooPaymentService.createPaylink(e,this.transactionsToRefund,this.orderItems).then(a=>{a.status?(t.paylinkMessage=t.$tc(a.message)+a.paylinkhref,t.paylink=a.paylink,this.$store.dispatch("notification/createNotification",{variant:"success",title:t.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:t.paylinkMessage})):this.$store.dispatch("notification/createNotification",{variant:"error",title:t.$tc("buckaroo-payment.settingsForm.titleError"),message:t.$tc(a.message)}),t.isPaylinkAvailable=!0}).catch(a=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:a.response.data.message}),t.isPaylinkAvailable=!0})},getConfigValue(e){return this.config[`BuckarooPayments.config.${e}`]},captureOrder(e){let t=this;t.isCapturePossible=!1,this.BuckarooPaymentService.captureOrder(e,this.transactionsToRefund,this.orderItems).then(a=>{a.status?this.$store.dispatch("notification/createNotification",{variant:"success",title:t.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:a.message}):this.$store.dispatch("notification/createNotification",{variant:"error",title:t.$tc("buckaroo-payment.settingsForm.titleError"),message:a.message}),t.isCapturePossible=!0,this.createdComponent()}).catch(a=>{this.$store.dispatch("notification/createNotification",{variant:"error",title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:t.$tc(a.response.data.message)}),t.isCapturePossible=!0})}}});const{Component:M}=Shopware;M.extend("buckaroo-payment-config","sw-extension-config",{});const N={"buckaroo-payment":{fee:"Buckaroo Betaaltoeslag",order:{refundDescription:"Refund voor bestelling #orderNumber"},general:{title:"Buckaroo",description:"Buckaroo Payment"},settingsForm:{save:"Opslaan",titleSuccess:"Succes",titleError:"Foutmelding"},supportModal:{menuButton:"Version & Support",title:"Versie & Support",support:{description:"Zorg ervoor dat u uw website key bij de hand heeft voordat u contact opneemt met Buckaroo technical support",label1:"Buckaroo Plaza:",label2:"Telefoonnummer:",label3:"E-mail:",label4:"Website:",your_version:"Uw PHP versie:",version:"Versie compatibiliteit",information:"Informatie"}},tabs:{title:"Buckaroo Payment",overview:"Overzicht"},paymentDetail:{yourLink:"Uw Paylink",paylinkButton:"Creëer Paylink",paylinkDescription:"Creëer Paylink voor order",paylinkTitle:"Paylink",refundTitle:"Terugbetaling",transactionsTitle:"Transacties",amountTitle:"Hoeveelheid",amountTotalTitle:"Algemeen totaal (grand total)",amountRefundTotalTitle:"Terugbetaling Algemeen totaal (grand total)",amountCustomRefundTitle:"Aangepast bedrag terugbetalen",buttonTitle:"Terugbetaling",successTitle:"Success",successMessage:"Buckaroo terugbetaling succesvol",errorTitle:"Foutmelding",payTitle:"Betaling vastleggen (Capture)",payDescription:"Factuur voor bestelling vastleggen (Capture) en aanmaken",payButton:"Betaling vastleggen (Capture)"},orderItems:{title:"Artikelen om terug te betalen",types:{id:"id",name:"Titel",quantity:"Aantal om terug te betalen",totalAmount:"Subtotaal"}},transactionsToRefund:{title:"Terugbetaling Totaal"},transactionHistory:{types:{id:"id",created_at:"Datum/tijd",total:"Totaal",shipping_costs:"Verzendkosten",total_excluding_vat:"Totaal exclusief BTW",total_including_vat:"Totaal inclusief BTW",vat:"BTW",transaction_key:"Transactie key",transaction_method:"Betaalmethode",statuscode:"Status"}},messageNotValid:"Dit veld is niet geldig.",messageNotBlank:"Dit veld mag niet leeg zijn.",button:{labelTestApi:"Test gegevens"},afterpay:{setup:"Belastingkoppeling instellen voor Riverty old ",hightTaxes:"Hoge BTW-heffingen",middleTaxes:"Middelmatige BTW-belastingen",lowTaxes:"Lage BTW-heffingen",zeroTaxes:"Nul VAT",noTaxes:"Geen BTW"},paymentInTestMode:"De betaling voor deze bestelling is in testmodus uitgevoerd",refund:{not_supported:"Terugbetaling wordt niet ondersteund",already_refunded:"Deze bestelling is al terugbetaald",refunded_amount:"Buckaroo terugbetaling succesvol"},test_api:{connection_ready:"Verbinding gereed",connection_failed:"Verbinding mislukt"},paylink:{invalid_amount:"Het bedrag is niet geldig",pay_link:"Uw Paylink:"},missing_order_id:"Ontbrekende bestelling orderId",missing_transaction:"Order transactie niet gevonden",general_request_error:"Helaas is er een fout opgetreden tijdens het verwerken van uw aanvraag. Probeer het opnieuw.",in3LogoLabel:"Betaalmethode Logo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}},j={"buckaroo-payment":{fee:"Buckaroo Gebühr",order:{refundDescription:"Rückerstattung für Bestellung #orderNumber"},general:{title:"Buckaroo",description:"Buckaroo Zahlung"},settingsForm:{save:"Speichern",titleSuccess:"Erfolg",titleError:"Fehler"},supportModal:{menuButton:"Version & Unterstützung",title:"Version & Unterstützung",support:{description:"Bevor Sie den technischen Support von Buckaroo kontaktieren, bitte holen Sie Ihren (Händler-)Schlüssel und Geheimschlüssel ab.",label1:"Buckaroo Plaza:",label2:"Telefon:",label3:"E-Mail:",label4:"Webseite:",your_version:"Ihre PHP-Version:",version:"Versionskompatibilität",information:"Informationen"}},tabs:{title:"Buckaroo Payment",overview:"Übersicht"},paymentDetail:{yourLink:"Ihr Paylink",paylinkButton:"Paylink erstellen",paylinkDescription:"Paylink erstellen für Bestellung",paylinkTitle:"Paylink",refundTitle:"Rückerstattung",transactionsTitle:"Transaktionen",amountTitle:"Betrag",amountTotalTitle:"Gesamtsumme",amountRefundTotalTitle:"Gesamtsumme der Rückerstattung",amountCustomRefundTitle:"Rückerstattung individueller Betrag",buttonTitle:"Rückerstattung",successTitle:"Erfolg",successMessage:"Buckaroo-Erfolg, zurückerstattet",errorTitle:"Fehler",payTitle:"Zahlung erfassen (Capture)",payDescription:"Erfassen (Capture) und Rechnung für Bestellung erstellen",payButton:"Zahlung erfassen (Capture)"},orderItems:{title:"Artikel zur Rückerstattung",types:{id:"id",name:"Titel",quantity:"Menge zur Rückerstattung",totalAmount:"Teilsumme"}},transactionsToRefund:{title:"Rückerstattungssummen"},transactionHistory:{types:{id:"id",created_at:"Datum/Uhrzeit",total:"Gesamt",shipping_costs:"Versandkosten",total_excluding_vat:"Gesamt ohne MwSt. (VAT)",total_including_vat:"Gesamt inklusive MwSt. (VAT)",vat:"MwSt. (VAT)",transaction_key:"Transaktionsschlüssel",transaction_method:"Zahlungsmethode",statuscode:"Status"}},messageNotValid:"Dieses Feld ist nicht gültig.",messageNotBlank:"Dieses Feld darf nicht leer sein.",button:{labelTestApi:"Verbindung testen"},afterpay:{setup:"Steuerzuordnung für Riverty old einrichten ",hightTaxes:"Hohe MwSt. (VAT)",middleTaxes:"Mittlere MwSt. (VAT)",lowTaxes:"Niedrige MwSt. (VAT)",zeroTaxes:"Keine MwSt. (VAT)",noTaxes:"Keine Mehrwertsteuer"},paymentInTestMode:"Die Zahlung für diese Bestellung wurde im Testmodus durchgeführt",refund:{not_supported:"Rückerstattung wird nicht unterstützt",already_refunded:"Diese Bestellung wurde bereits zurückerstattet",refunded_amount:"Erfolgreich von Buckaroo erstattet"},test_api:{connection_ready:"Verbindung bereit",connection_failed:"Verbindung fehlgeschlagen"},paylink:{invalid_amount:"Betrag ist nicht gültig",pay_link:"Ihr Zahlungslink (Paylink):"},missing_order_id:"Fehlende Bestell-ID",missing_transaction:"Transaktion der Bestellung nicht gefunden",general_request_error:"Leider ist ein Fehler bei der Bearbeitung Ihrer Anfrage aufgetreten. Bitte versuchen Sie es erneut.",in3LogoLabel:"Zahlungslogo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}},L={"buckaroo-payment":{fee:"Buckaroo Fee",order:{refundDescription:"Refund for order #orderNumber"},general:{title:"Buckaroo",description:"Buckaroo Payment"},settingsForm:{save:"Save",titleSuccess:"Success",titleError:"Error"},supportModal:{menuButton:"Version & Support",title:"Version & Support",support:{description:"Before contacting Buckaroo technical support, please retrieve your (Merchant) key, Secret key, certificate and certificate thumbprint.",label1:"Buckaroo Payment Plaza:",label2:"Phone:",label3:"E-mail:",label4:"Website:",your_version:"Your PHP version:",version:"Version compatibility",information:"Information"}},tabs:{title:"Buckaroo Payment",overview:"Overview"},paymentDetail:{yourLink:"Your Paylink",paylinkButton:"Create paylink",paylinkDescription:"Create paylink for order",paylinkTitle:"Paylink",refundTitle:"Refund",transactionsTitle:"Transactions",amountTitle:"Amount",amountTotalTitle:"Grand total",amountRefundTotalTitle:"Refund Grand total",amountCustomRefundTitle:"Refund custom amount",buttonTitle:"Refund",successTitle:"Success",successMessage:"Buckaroo success refunded ",errorTitle:"Error",payTitle:"Capture payment",payDescription:"Capture and create invoice for order",payButton:"Capture payment"},orderItems:{title:"Items to Refund",types:{id:"id",name:"Title",quantity:"Qty to Refund",totalAmount:"Subtotal"}},transactionsToRefund:{title:"Refund Totals"},transactionHistory:{types:{id:"id",created_at:"Date/time",total:"Total",shipping_costs:"Shipping costs",total_excluding_vat:"Total excluding VAT",total_including_vat:"Total including VAT",vat:"VAT",transaction_key:"Transaction key",transaction_method:"Payment method",statuscode:"Status"}},messageNotValid:"This field not valid.",messageNotBlank:"This field must not be empty.",button:{labelTestApi:"Test connection"},afterpay:{setup:"Setup tax association for Riverty old ",hightTaxes:"High VAT taxes",middleTaxes:"Middle VAT taxes",lowTaxes:"Low VAT taxes",zeroTaxes:"Zero VAT",noTaxes:"No VAT tax"},paymentInTestMode:"The payment for this order was made in test mode",refund:{not_supported:"Refund is not supported",already_refunded:"This order is already refunded",refunded_amount:"Buckaroo success refunded"},test_api:{connection_ready:"Connection ready",connection_failed:"Connection failed"},paylink:{invalid_amount:"Amount is not valid",pay_link:"Your Paylink:"},missing_order_id:"Missing order orderId",missing_transaction:"Order transaction not found",general_request_error:"Unfortunately an error occurred while processing your request. Please try again.",in3LogoLabel:"Payment Logo:","configure-payment":"Configure payment","configure-link":"Configure","payment-methods":"Payment methods"}},{Module:q}=Shopware;q.register("buckaroo-payment",{type:"plugin",name:"BuckarooPayment",title:"buckaroo-payment.general.title",description:"buckaroo-payment.general.description",version:"1.0.0",targetVersion:"1.0.0",color:"#000000",icon:"default-action-settings",snippets:{"nl-NL":N,"de-DE":j,"en-GB":L},routeMiddleware(e,t){t.name==="sw.order.detail"&&t.children.push({component:"buckaroo-payment-detail",name:"buckaroo.payment.detail",isChildren:!0,path:"/sw/order/buckaroo/detail/:id"}),e(t)},routes:{config:{component:"buckaroo-payment-config",path:":namespace/payment/:paymentCode",name:"buckaroo.config.payment",meta:{parentPath:"sw.extension.config"},props:{default(e){return{namespace:e.params.namespace}}}}}});const{ApiService:y}=Shopware.Classes;class z extends y{constructor(t,a,o="buckaroo"){super(t,a,o)}getBasicHeaders(){return this.loginService&&typeof this.loginService.getToken=="function"?super.getBasicHeaders():{"Content-Type":"application/json",Accept:"application/json"}}getBuckarooTransaction(t){const a=`_action/${this.getApiBasePath()}/getBuckarooTransaction`;return this.httpClient.post(a,{transaction:t},{headers:this.getBasicHeaders()}).then(o=>y.handleResponse(o))}refundPayment(t,a,o,n){const s=`_action/${this.getApiBasePath()}/refund`;return this.httpClient.post(s,{transaction:t,transactionsToRefund:a,orderItems:o,customRefundAmount:n},{headers:this.getBasicHeaders()}).then(u=>y.handleResponse(u))}captureOrder(t){const a=`_action/${this.getApiBasePath()}/capture`;return this.httpClient.post(a,{transaction:t},{headers:this.getBasicHeaders()}).then(o=>y.handleResponse(o))}createPaylink(t){const a=`_action/${this.getApiBasePath()}/paylink`;return this.httpClient.post(a,{transaction:t},{headers:this.getBasicHeaders()}).then(o=>y.handleResponse(o))}}Shopware.Service().register("BuckarooPaymentService",()=>{const e=Shopware.Application.getContainer("init"),t=Shopware.Service("loginService");return new z(e.httpClient,t)});const{ApiService:b}=Shopware.Classes;class H extends b{constructor(t,a,o="buckaroo"){super(t,a,o)}getBasicHeaders(){return this.loginService&&typeof this.loginService.getToken=="function"?super.getBasicHeaders():{"Content-Type":"application/json",Accept:"application/json"}}getSupportVersion(){const t=`_action/${this.getApiBasePath()}/version`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(a=>b.handleResponse(a))}getTaxes(){const t=`_action/${this.getApiBasePath()}/taxes`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(a=>b.handleResponse(a))}getIn3Icons(){const t=`_action/${this.getApiBasePath()}/in3/logos`;return this.httpClient.post(t,{},{headers:this.getBasicHeaders()}).then(a=>b.handleResponse(a))}getApiTest(t,a,o){const n=`_action/${this.getApiBasePath()}/getBuckarooApiTest`;return this.httpClient.post(n,{websiteKeyId:t,secretKeyId:a,saleChannelId:o},{headers:this.getBasicHeaders()}).then(s=>b.handleResponse(s))}}Shopware.Service().register("BuckarooPaymentSettingsService",()=>{const e=Shopware.Application.getContainer("init"),t=Shopware.Service("loginService");return new H(e.httpClient,t)});const G=`<div> <a style="margin-bottom:10px;" @click="showTaxes = !showTaxes">{{$tc('buckaroo-payment.afterpay.setup')}}</a> <div v-if="showTaxes" style="padding: 10px;background: rgb(246 246 246); margin-bottom:10px;"> <div class="tax" v-for="tax in taxes"> <sw-select-field :label="tax.name" label-property="name" value-property="id" :options="afterpayTaxes" @change="(value) => setTaxAssociation(tax.id, value)" @input="(value) => setTaxAssociation(tax.id, value)" @update:value="(value) => setTaxAssociation(tax.id, value)" :value="getSelectValue(tax.id)" ></sw-select-field> </div> </div> </div>`,{Component:O}=Shopware;O.register("buckaroo-afterpay-old-tax",{template:G,inject:["BuckarooPaymentSettingsService"],data(){return{taxes:[],showTaxes:!1,afterpayTaxes:[{name:this.$tc("buckaroo-payment.afterpay.hightTaxes"),id:1},{name:this.$tc("buckaroo-payment.afterpay.middleTaxes"),id:5},{name:this.$tc("buckaroo-payment.afterpay.lowTaxes"),id:2},{name:this.$tc("buckaroo-payment.afterpay.zeroTaxes"),id:3},{name:this.$tc("buckaroo-payment.afterpay.noTaxes"),id:4}],taxAssociation:{}}},model:{prop:"value",event:"change"},computed:{},props:{name:{type:String,required:!0,default:""},value:{type:Object,required:!1,default(){return{}}}},created(){this.BuckarooPaymentSettingsService.getTaxes().then(e=>{this.taxes=e.taxes.map(t=>({id:t.id,name:t.name}))})},methods:{setTaxAssociation(e,t){try{let a=t;t&&typeof t=="object"&&(t.target?a=t.target.value:t.hasOwnProperty("value")?a=t.value:t.hasOwnProperty("id")&&(a=t.id)),this.taxAssociation[e]=a,this.$emit("change",{...this.value,...this.taxAssociation})}catch(a){console.error("Error in setTaxAssociation:",a)}},getSelectValue(e){if(this.value[e])return this.value[e]}}});const K=`<div> <buckaroo-config-card :card="mainCard" :configSettings="configSettings" :methods="elementMethods" :isNotDefaultSalesChannel="isNotDefaultSalesChannel" :value="value" :currentSalesChannelId="currentSalesChannelId" @input="onInput" v-if="mainCard && value"> </buckaroo-config-card> <buckaroo-payment-list v-if="selectedCard === 'general'" :configSettings="configSettings" :currentSalesChannelId="currentSalesChannelId" :value="value" @input="onInput"> </buckaroo-payment-list> </div>`,{Component:U}=Shopware;U.register("buckaroo-main-config",{template:K,props:{configSettings:{type:Array,required:!1,default:()=>[]},value:{type:Object,required:!1,default:()=>({})},elementMethods:{type:Object,required:!1,default:()=>({})},isNotDefaultSalesChannel:{type:Boolean,required:!1,default:!1},currentSalesChannelId:{type:String,required:!1,default:null}},emits:["input"],model:{prop:"value",event:"input"},data(){var e;return{selectedCard:((e=this.$route.params)==null?void 0:e.paymentCode)||"general"}},watch:{value:{handler(e,t){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0,immediate:!0},$route(e){var t;(t=e.params)!=null&&t.paymentCode&&(this.selectedCard=e.params.paymentCode)}},computed:{mainCard(){var t;return(t=this.configSettings.filter(a=>a.name===this.selectedCard))==null?void 0:t.pop()}},methods:{onInput(e){this.$emit("input",e)}}});const W=`{% block buckaroo_config_card %} <sw-card position-identifier="xxsw-system-config-content" v-if="card"> <template #title> {{ getInlineSnippet(card.title) || 'Configuration' }} </template> <div v-for="element in (card.elements || [])" :key="element.name"> <div v-if="canShow(element)"> <slot name="card-element" v-bind="{ element: getElementBind(element), config: value, card }"> <sw-inherit-wrapper :value="getValueForName(element.name.replace('BuckarooPayments.config.', ''))" v-bind="getInheritWrapperBind(element)" :has-parent="isNotDefaultSalesChannel" :inherited-value="getInheritedValue(element)" :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name)" @input="onFieldInput(element.name, $event)" > <template #content="props"> {# Special handling for fields that must be true multi-selects #} <template v-if="['allowedcreditcard', 'allowedcreditcards', 'allowedgiftcards', 'giftcardsPaymentmethods', 'payperemailAllowed'].includes(element.name.replace('BuckarooPayments.config.', ''))"> <sw-multi-select v-bind="getElementBind(element, props)" :key="\`\${element.name}-multi-\${props.isInheritField}-\${props.isInherited}\`" :disabled="props.isInherited" :value="Array.isArray(props.currentValue) ? props.currentValue : (props.currentValue ? [props.currentValue] : [])" :options=" (getElementBind(element, props).config && getElementBind(element, props).config.options ? getElementBind(element, props).config.options : [] ).map(opt => ({ value: opt.id, label: opt.name && typeof opt.name === 'object' ? (opt.name[$i18n.locale] || opt.name['en-GB'] || Object.values(opt.name)[0] || opt.id) : (opt.name || opt.id) })) " labelProperty="label" valueProperty="value" :error="getFieldError(element.name)" @change="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }" @update:value="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }" /> </template> <template v-else> <sw-form-field-renderer v-bind="getElementBind(element, props)" :key="element.type === 'bool' ? \`\${element.name}-\${props.isInheritField}-\${props.isInherited}-\${props.currentValue}\` : \`\${element.name}-\${props.isInheritField}-\${props.isInherited}\`" :disabled="props.isInherited" :value="element.type === 'bool' ? Boolean(props.currentValue) : props.currentValue" :error="getFieldError(element.name)" @input="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }" @change="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }" @update:value="(value) => { props.updateCurrentValue(value); onFieldInput(element.name, value); }" /> </template> </template> </sw-inherit-wrapper> </slot> </div> </div> <buckaroo-test-credentials v-if="canShowCredentialTester" :config="value" :currentSalesChannelId="currentSalesChannelId" /> </sw-card> {% endblock %}`,{Component:Z}=Shopware;Z.register("buckaroo-config-card",{template:W,mounted(){this.$nextTick(()=>{this.$forceUpdate()})},watch:{value:{handler(){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0,immediate:!0},currentSalesChannelId:{handler(e,t){e!==t&&this.$nextTick(()=>{this.$forceUpdate()})},immediate:!1}},computed:{canShowCredentialTester(){var u;const e=this.getValueForName("websiteKey"),t=this.getValueForName("secretKey");if(!(((u=this.card)==null?void 0:u.name)==="general"))return!1;const o=e!=null&&e!=="",n=t!=null&&t!=="";return o||n},hasValidConfigData(){return this.value&&typeof this.value=="object"&&Object.keys(this.value).length>0},reactiveValue(){return this.value}},emits:["input"],model:{prop:"value",event:"input"},props:{card:{type:Object,required:!1,default:()=>({elements:[]})},configSettings:{type:Array,required:!1,default:()=>[]},methods:{type:Object,required:!0},isNotDefaultSalesChannel:{type:Boolean,required:!0},currentSalesChannelId:{type:String,required:!0},value:{type:Object,required:!1,default:()=>({})}},methods:{getElementBind(e,t={}){var v,w,l,k,f,h,p;if(!this.methods||!this.methods.getElementBind){const c=e.label?this.getInlineSnippet(e.label):null;return{name:e.name,type:e.type||"text",config:e.config||{},label:c,value:this.getValueForName(e.name.replace("BuckarooPayments.config.",""))}}const a=this.methods.getElementBind(e,t),o=e.name.replace("BuckarooPayments.config.","");let n=this.getValueForName(o);const s=a.config||e.config||{};e.type==="bool"&&(n==null?n=a.value!==void 0?a.value:!1:typeof n=="string"?n=n==="1"||n==="true"||n==="on":n=!!n);let u=null;if((e.type==="bool"||e.type==="single-select"||e.type==="multi-select")&&this.configSettings&&Array.isArray(this.configSettings)){for(const c of this.configSettings)if(c.elements&&Array.isArray(c.elements)){const r=c.elements.find(d=>d.name===e.name);if(r){if(r.label){let d=this.getInlineSnippet(r.label);if(!d||typeof d=="string"&&d.trim().length===0)if(typeof r.label=="object"&&r.label!==null){const C=((v=this.$i18n)==null?void 0:v.locale)||"en-GB";d=r.label[C]||r.label["en-GB"]||Object.values(r.label)[0]||null}else typeof r.label=="string"&&(d=r.label);if(d&&typeof d=="string"&&d.trim().length>0){u=d;break}}if(!u&&r.config&&r.config.label){let d=this.getInlineSnippet(r.config.label);if(!d||typeof d=="string"&&d.trim().length===0)if(typeof r.config.label=="object"&&r.config.label!==null){const C=((w=this.$i18n)==null?void 0:w.locale)||"en-GB";d=r.config.label[C]||r.config.label["en-GB"]||Object.values(r.config.label)[0]||null}else typeof r.config.label=="string"&&(d=r.config.label);if(d&&typeof d=="string"&&d.trim().length>0){u=d;break}}}}}if(!u){if(a.label&&typeof a.label=="string"&&a.label.trim().length>0)u=a.label;else if(e.label){let c=this.getInlineSnippet(e.label);if(!c||typeof c=="string"&&c.trim().length===0)if(typeof e.label=="object"&&e.label!==null){const r=((l=this.$i18n)==null?void 0:l.locale)||"en-GB";c=e.label[r]||e.label["en-GB"]||Object.values(e.label)[0]||null}else typeof e.label=="string"&&(c=e.label);c&&typeof c=="string"&&c.trim().length>0&&(u=c)}else if(this.card&&this.card.elements&&Array.isArray(this.card.elements)){const c=this.card.elements.find(r=>r.name===e.name);if(c&&c.label){let r=this.getInlineSnippet(c.label);if(!r||typeof r=="string"&&r.trim().length===0)if(typeof c.label=="object"&&c.label!==null){const d=((k=this.$i18n)==null?void 0:k.locale)||"en-GB";r=c.label[d]||c.label["en-GB"]||Object.values(c.label)[0]||null}else typeof c.label=="string"&&(r=c.label);r&&typeof r=="string"&&r.trim().length>0&&(u=r)}}}!u&&a.config&&a.config.label&&typeof a.config.label=="string"&&a.config.label.trim().length>0&&(u=a.config.label);let g=s;u&&typeof u=="string"&&u.trim().length>0&&(e.type==="bool"||e.type==="single-select"||e.type==="multi-select")&&(g={...s,label:u});const i={...a,config:g};if(["allowedcreditcard","allowedcreditcards","allowedgiftcards","giftcardsPaymentmethods","payperemailAllowed"].includes(o)){i.type="multi-select",i.componentName="sw-multi-select",i.config={...i.config||{},multiple:!0,options:i.config&&i.config.options||s&&s.options||e.options||[]};const c=Array.isArray((f=i.config)==null?void 0:f.options)&&i.config.options.length>0?i.config.options[0]:null;console.debug("[BuckarooConfigCard] getElementBind multi-select binding",{fieldName:o,bindingType:i.type,componentName:i.componentName,optionsCount:Array.isArray((h=i.config)==null?void 0:h.options)?i.config.options.length:0,currentValue:n,sampleOption:c})}return u&&typeof u=="string"&&u.trim().length>0&&(e.type==="bool"||!i.label||typeof i.label=="string"&&i.label.trim().length===0)&&(i.label=u),e.type==="bool"&&(i.value=n,(!i.label||typeof i.label=="string"&&i.label.trim().length===0)&&(i.label=((p=i.config)==null?void 0:p.label)||e.name.replace("BuckarooPayments.config.","").replace(/([A-Z])/g," $1").trim())),(e.type==="bool"||e.type==="single-select"||e.type==="multi-select")&&(!i.label||typeof i.label=="string"&&i.label.trim().length===0)&&console.warn("Missing label for field:",e.name,"Type:",e.type,"Element label:",e.label,"Extracted:",u,"BaseBinding label:",a.label,"Final binding label:",i.label),i},getInheritWrapperBind(e){if(!this.methods||!this.methods.getInheritWrapperBind){const n=e.name.replace("BuckarooPayments.config.","");return{name:e.name,currentValue:this.getValueForName(n)}}const t=this.methods.getInheritWrapperBind(e),a=e.name.replace("BuckarooPayments.config.",""),o=this.getValueForName(a);return t.currentValue=o,t},getFieldError(e){return!this.methods||!this.methods.getFieldError?null:this.methods.getFieldError(e)},kebabCase(e){return!this.methods||!this.methods.kebabCase?e?e.toLowerCase().replace(/[A-Z]/g,"-$&").replace(/^-/,""):"":this.methods.kebabCase(e)},getInlineSnippet(e){var t;try{if(typeof e=="object"&&e!==null){const a=((t=this.$i18n)==null?void 0:t.locale)||"en-GB";if(e[a])return e[a];if(e["en-GB"])return e["en-GB"];const o=Object.keys(e)[0];return o&&e[o]?e[o]:JSON.stringify(e)}return typeof e=="string"?this.$t&&typeof this.$t=="function"?this.$t(e):e:String(e)}catch(a){return console.warn("Translation error for:",e,a),typeof e=="object"?JSON.stringify(e):String(e)}},getInheritedValue(e){return!this.methods||!this.methods.getInheritedValue?null:this.methods.getInheritedValue(e)},getValueForName(e){const t=this.reactiveValue;if(!t||typeof t!="object")return null;let a;const o=[`BuckarooPayments.config.${e}`,e.toLowerCase(),e.charAt(0).toLowerCase()+e.slice(1),e.charAt(0).toUpperCase()+e.slice(1)];for(const n of o)if(t[n]!==void 0){a=t[n];break}if(a===void 0&&t["BuckarooPayments.config"]&&typeof t["BuckarooPayments.config"]=="object"){for(const n of o)if(t["BuckarooPayments.config"][n]!==void 0){a=t["BuckarooPayments.config"][n];break}}return a&&typeof a=="object"&&a.hasOwnProperty("_value")&&(a=a._value),a},canShow(e){if(!e||!e.name)return!1;const t=e.name.replace("BuckarooPayments.config.","");return["orderStatus","paymentSuccesStatus","automaticallyCloseOpenOrders","sendInvoiceEmail"].includes(t)?!!this.getValueForName("advancedConfiguration"):t==="idealprocessingRenderMode"?!!this.getValueForName("idealprocessingShowissuers"):t==="idealRenderMode"?!!this.getValueForName("idealShowissuers"):["idealFastCheckoutEnabled","idealFastCheckoutVisibility","idealFastCheckoutLogoScheme"].includes(t)?!!this.getValueForName("idealFastCheckout"):t==="afterpayPaymentstatus"?!!this.getValueForName("afterpayCaptureonshippent"):t==="afterpayOldtax"?!!this.getValueForName("afterpayEnabledold"):!0},onInput(e){this.$emit("input",e)},onFieldInput(e,t){var a,o;try{let n=t;if(t&&typeof t=="object")if(t.target){const i=t.target;i.type==="checkbox"||i.type==="radio"?n=i.checked:(i.tagName==="SELECT"||i.type==="select-one"||i.type==="select-multiple")&&i.multiple?n=Array.from(i.selectedOptions).map(m=>m.value):n=i.value}else if(t.hasOwnProperty("value"))n=t.value;else if(t.hasOwnProperty("id")&&t.hasOwnProperty("name"))n=t.id;else if(Array.isArray(t)){const i=t.filter(l=>typeof l=="string"&&l.length===1).length,m=t.some(l=>l===","),v=t.some(l=>typeof l=="string"&&l.length>1);if(i>10&&m){const l=t.filter(p=>typeof p=="string"&&p.length>1),f=t.filter(p=>typeof p=="string"&&p.length===1).join("");let h=[];f.includes(",")?h=f.split(",").map(p=>p.trim()).filter(p=>p.length>0):f.length>0&&(h=[f]),n=[...h,...l].filter(p=>p&&p.length>0)}else n=t.filter(l=>!(l==null||l===""||typeof l=="string"&&l.length===1||typeof l=="string"&&(l.startsWith("+")||/^\d+$/.test(l)))).map(l=>typeof l=="object"&&l!==null&&(l.id||l.value||l.code||l.key)||l)}else{const i=["id","value","key","code"];for(const m of i)if(t[m]!==void 0){n=t[m];break}}else(typeof t=="boolean"||typeof t=="string"||typeof t=="number")&&(n=t);const s=(o=(a=this.card)==null?void 0:a.elements)==null?void 0:o.find(i=>i.name===e||i.name.replace("BuckarooPayments.config.","")===e.replace("BuckarooPayments.config.",""));n==="on"?n=!0:n==="off"&&(n=!1),s&&s.type==="bool"&&(typeof n=="string"?n=n==="1"||n==="true"||n==="on":n=!!n),s&&s.type==="multi-select"&&(console.debug("[BuckarooConfigCard] onFieldInput before normalize (multi-select)",{fieldName:e,rawEvent:t,rawValue:n}),Array.isArray(n)?n=n.filter(i=>i!=null&&i!=="").map(i=>typeof i=="object"&&i!==null&&(i.id||i.value||i.code||i.key)||i):typeof n=="string"?n=n.split(",").map(i=>i.trim()).filter(i=>i.length>0):n==null?n=[]:n=[n],console.debug("[BuckarooConfigCard] onFieldInput after normalize (multi-select)",{fieldName:e,normalizedValue:n}));const u=e.replace("BuckarooPayments.config.",""),g={...this.value};g[u]=n,g[e]=n,this.$emit("input",g)}catch(n){console.error("Error in onFieldInput:",n),console.error("Error details:",n.stack)}}}});const J=`<sw-card position-identifier="bk-config-payment-list" :title="$tc('buckaroo-payment.payment-methods')" > <div class="bk-payment-wrap"> <template v-for="payment in payments" > <div class="bk-payment"> <div class="bk-payment-inner"> <router-link :title="$tc('buckaroo-payment.configure-payment')" :to="{name: 'buckaroo.payment.config', params: {namespace: 'BuckarooPayments', paymentCode: payment.code } }"> <div class="bk-payment-img"> <img :src="assetFilter(\`buckaroopayments/images/\${payment.logo}\`)" alt="Payment logo"> </div> <div class="bk-payment-name"> {{ getPaymentTitle(payment.code) }} </div> </router-link> <buckaroo-toggle-status :currentSalesChannelId="currentSalesChannelId" :method="payment.code" :value="value" @input="$emit('input', $event)" /> <router-link class="bk-link" :title="$tc('buckaroo-payment.configure-payment')" :to="{name: 'buckaroo.payment.config', params: {namespace: 'BuckarooPayments', paymentCode: payment.code } }"> {{$tc('buckaroo-payment.configure-link')}} </router-link> </div> </div> </template> </div> </sw-card>`,{Component:Y,Filter:Q}=Shopware;Y.register("buckaroo-payment-list",{template:J,props:{configSettings:{type:Array,required:!1,default:()=>[]},value:{type:Object,required:!1,default:()=>({})},currentSalesChannelId:{type:String,required:!0}},emits:["input"],data(){return{payments:[{code:"Alipay",logo:"alipay.svg"},{code:"applepay",logo:"applepay.svg"},{code:"bancontactmrcash",logo:"bancontact.svg"},{code:"blik",logo:"blik.svg"},{code:"belfius",logo:"belfius.svg"},{code:"Billink",logo:"billink.svg"},{code:"creditcard",logo:"creditcards.svg"},{code:"creditcards",logo:"creditcards.svg"},{code:"eps",logo:"eps.svg"},{code:"giftcards",logo:"giftcards.svg"},{code:"idealqr",logo:"ideal-qr.svg"},{code:"ideal",logo:"ideal-wero.svg"},{code:"capayable",logo:"in3.svg"},{code:"KBCPaymentButton",logo:"kbc.svg"},{code:"klarnakp",logo:"klarna.svg"},{code:"knaken",logo:"gosettle.svg"},{code:"mbway",logo:"mbway.svg"},{code:"multibanco",logo:"multibanco.svg"},{code:"paybybank",logo:"paybybank.svg"},{code:"payconiq",logo:"payconiq.svg"},{code:"paypal",logo:"paypal.svg"},{code:"payperemail",logo:"payperemail.svg"},{code:"Przelewy24",logo:"przelewy24.svg"},{code:"afterpay",logo:"afterpay.svg"},{code:"sepadirectdebit",logo:"sepa-directdebit.svg"},{code:"transfer",logo:"sepa-credittransfer.svg"},{code:"Trustly",logo:"trustly.svg"},{code:"WeChatPay",logo:"wechatpay.svg"},{code:"swish",logo:"swish.svg"},{code:"bizum",logo:"bizum.svg"},{code:"twint",logo:"twint.svg"},{code:"wero",logo:"wero.svg"}]}},methods:{getPaymentTitle(e){var a;if(this.configSettings&&Array.isArray(this.configSettings)){const o=this.configSettings.find(n=>n.name===e);if(o&&o.title)try{if(typeof o.title=="object"&&o.title!==null){const n=((a=this.$i18n)==null?void 0:a.locale)||"en-GB";if(o.title[n])return o.title[n];if(o.title["en-GB"])return o.title["en-GB"];const s=Object.keys(o.title)[0];return s&&o.title[s]?o.title[s]:JSON.stringify(o.title)}return typeof o.title=="string"?this.$t&&typeof this.$t=="function"?this.$t(o.title):o.title:String(o.title)}catch(n){return console.warn("Translation error for:",o.title,n),typeof o.title=="object"?JSON.stringify(o.title):String(o.title)}}const t=this.payments.find(o=>o.code===e);return t?t.code:"Unknown Payment"},assetFilter(e){return Q.getByName("asset")(e)}}});const X=`<sw-button @click="sendTestApi" :disabled="!enabled" variant="primary" :square="false" :block="true" :isLoading="isLoading">{{ $tc('buckaroo-payment.button.labelTestApi') }}</sw-button>`,{Component:ee}=Shopware;ee.register("buckaroo-test-credentials",{template:X,mixins:[Shopware.Mixin.getByName("notification")],data(){return{isLoading:!1}},inject:["BuckarooPaymentSettingsService"],props:{config:{type:Object,required:!0},currentSalesChannelId:{required:!0}},computed:{enabled:function(){return(this.getConfigValue("websiteKey")||"").length>0&&(this.getConfigValue("secretKey")||"").length>0}},methods:{getConfigValue:function(e){return this.config["BuckarooPayments.config."+e]},sendTestApi(){this.isLoading=!0;let e=this.getConfigValue("websiteKey"),t=this.getConfigValue("secretKey");this.BuckarooPaymentSettingsService.getApiTest(e,t,this.currentSalesChannelId).then(a=>{this.isLoading=!1,a.status=="success"?this.createNotificationSuccess({title:this.$tc("buckaroo-payment.settingsForm.titleSuccess"),message:this.$tc(a.message)}):this.createNotificationError({title:this.$tc("buckaroo-payment.settingsForm.titleError"),message:this.$tc(a.message)})}).catch(()=>{this.isLoading=!1})}}});const te=`<div class="bk-toogle-wrap"> <button type="button" :disabled="isLoading" :class="\`live \${getClass('live')}\`" @click="setStatus('live')" > Live </button> <button v-if="method !== 'idealqr'" type="button" :disabled="isLoading" :class="\`test \${getClass('test')}\`" @click="setStatus('test')" > Test </button> <button type="button" :disabled="isLoading" :class="\`disabled \${getClass('disabled')}\`" @click="setStatus('disabled')" > Off </button> </div>`,{Component:ae}=Shopware;ae.register("buckaroo-toggle-status",{template:te,props:{method:{type:String,required:!0},value:{required:!0},currentSalesChannelId:{required:!0}},emits:["input"],inject:["systemConfigApiService"],data(){return{status:"disabled",isLoading:!1}},mounted(){this.status=this.getStatus()},watch:{value:{handler(e){this.status=this.getStatus()},deep:!0,immediate:!0}},methods:{getStatus(){const e=this.isActive(),t=this.getEnvironment();return e?t:"disabled"},isActive(){const e=this.getValueForName(`${this.method}Enabled`);return typeof e=="string"?e.toLowerCase()==="true":!!e},getEnvironment(){const e=this.getValueForName(`${this.method}Environment`);return e==null||e===""?"test":["test","live"].includes(e)?e:"test"},getValueForName(e){const t=`BuckarooPayments.config.${e}`;if(!this.value||typeof this.value!="object")return null;let a;if(this.value[t]!==void 0)a=this.value[t];else if(this.value[e]!==void 0)a=this.value[e];else if(this.value["BuckarooPayments.config"]&&typeof this.value["BuckarooPayments.config"]=="object")this.value["BuckarooPayments.config"][e]!==void 0&&(a=this.value["BuckarooPayments.config"][e]);else{const o=[e,e.toLowerCase(),e.charAt(0).toLowerCase()+e.slice(1),e.charAt(0).toUpperCase()+e.slice(1)];for(const n of o){const s=`BuckarooPayments.config.${n}`;if(this.value[s]!==void 0){a=this.value[s];break}if(this.value[n]!==void 0){a=this.value[n];break}}}return a&&typeof a=="object"&&a.hasOwnProperty("_value")&&(a=a._value),a},setStatus(e){this.status=e,this.saveStatus()},getClass(e){return this.status===e?"active":""},async saveStatus(){const e=`BuckarooPayments.config.${this.method}Enabled`,t=`BuckarooPayments.config.${this.method}Environment`;let a={[e]:!1};const o={...this.value};o[e]=!1,["live","test"].indexOf(this.status)!==-1&&(a={[e]:!0,[t]:this.status},o[e]=!0,o[t]=this.status),this.$emit("input",o),this.isLoading=!0;try{await this.systemConfigApiService.batchSave({[this.currentSalesChannelId]:a}).finally(()=>{this.isLoading=!1}),this.renderSuccess()}catch(n){this.renderError(n)}},renderSuccess(){this.$store.dispatch("notification/createNotification",{variant:"success",message:this.$tc("sw-extension-store.component.sw-extension-config.messageSaveSuccess")})},renderError(e){this.$store.dispatch("notification/createNotification",{variant:"error",message:e})}}});
//# sourceMappingURL=buckaroo-payments-K_55L2UJ.js.map
